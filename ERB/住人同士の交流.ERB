;-------------------------------------------------------------------------------
;内容について
;0=なし, 300X=会話, 301X=お茶, 302X=スキンシップ, 310X=尻を撫でる, 311X=抱きつく
;312X=キスする, 313X=胸愛撫, 314X=アナル愛撫, 315X=クリ愛撫, 316X=指挿れ
;350X=性交(裸), 351X=性交(着衣), 352X=アナル性交(裸), 353X=アナル性交(着衣)
;354X=後戯(イチャイチャタイム)(裸・前), 355X=後戯(着衣・前), 356X=後戯(裸・後)
;357X=後戯(着衣・後)
;Xは0が受け, 1が攻め
;


;-------------------------------------------------------------------------------
;住人同士イベント実行判定
;@return 1:xxx,0:xxx
@INHABITANT_DO
	#DIM LOOP_CHR_0
	#DIM LOOP_CHR_1
	#DIM LOOP_CHR_2
	#DIM LOOP_CHR_3
	#DIM INTRUDER
	#DIM MAX_LOOP
	#DIM 同室人数
	#DIM 相手番号
	
	CALL INHABITANT_SETTINGS_FIRST
	SIF !GETBIT(FLAG:住人同士イベント設定,0)
		RETURN 0
	;実行可否チェック
	;主人公, 訪問者, 実行相手以外の住人が居る時は発生しない
	SIF GETBIT(FLAG:住人同士イベント設定,2)
		PRINTL
	MAX_LOOP = INHABITANT_LOOP_MAX()
	FOR LOOP_CHR_0,1,MAX_LOOP
		SIF CFLAG:LOOP_CHR_0:住人同士イベント相手 < LOOP_CHR_0 && CFLAG:LOOP_CHR_0:住人同士イベント相手 != 0
			CONTINUE
		IF CFLAG:LOOP_CHR_0:睡眠
			CALL INHABITANT_FRIENDSHIP_FINISH(LOOP_CHR_0,0,CFLAG:LOOP_CHR_0:住人同士イベントシチュエーション)
			CONTINUE
		ENDIF
		同室人数 = 0
		相手番号 = 0
		FOR LOOP_CHR_1,0,MAX_LOOP
			SIF LOOP_CHR_0 == LOOP_CHR_1
				CONTINUE
			SIF CFLAG:(LOOP_CHR_1):睡眠
				CONTINUE
			IF CFLAG:LOOP_CHR_0:現在位置 == CFLAG:LOOP_CHR_1:現在位置
				SIF CFLAG:LOOP_CHR_0:住人同士イベント内容 != 0 && CFLAG:LOOP_CHR_0:住人同士イベント相手 != LOOP_CHR_1
					INTRUDER = LOOP_CHR_1
				相手番号 = LOOP_CHR_1
				同室人数 += 1
;				PRINTFORMW {同室人数}, %CALLNAME:LOOP_CHR_1%, {TA:LOOP_CHR_0:LOOP_CHR_1:TA_好感度}
;				TA:LOOP_CHR_0:LOOP_CHR_1:TA_好感度 = 2000
			ENDIF
;			PRINTFORMW {LOOP_CHR_0},{CFLAG:LOOP_CHR_0:住人同士イベント相手}, {LOOP_CHR_1},{CFLAG:LOOP_CHR_1:住人同士イベント相手}
		NEXT
		IF CFLAG:LOOP_CHR_0:現在位置 == FLAG:訪問者の現在位置
			SIF CFLAG:LOOP_CHR_0:住人同士イベント内容 != 0
				INTRUDER = 人物_訪問者
			同室人数 += 1
		ENDIF
;		PRINTFORMW {相手番号}
		IF 同室人数 == 1
;			PRINTFORMW 住人イベント管理へ
			SIF 相手番号 == 0 || 相手番号 > MAX_LOOP
				CONTINUE
			CALL INHABITANT_FRIENDSHIP(LOOP_CHR_0,相手番号)
		ELSEIF CFLAG:LOOP_CHR_0:住人同士イベント内容 != 0
			FOR LOOP_CHR_2,1,MAX_LOOP
				FOR LOOP_CHR_3,0,CHARANUM
					SIF LOOP_CHR_2 == LOOP_CHR_3
						CONTINUE
					SIF CFLAG:LOOP_CHR_2:現在位置 == CFLAG:LOOP_CHR_3:現在位置
						CALL INHABITANT_FRIENDSHIP_END(LOOP_CHR_0,0,INTRUDER,CFLAG:LOOP_CHR_0:住人同士イベントシチュエーション)
				NEXT
			NEXT
		ENDIF
	NEXT
	SIF GETBIT(FLAG:住人同士イベント設定,2)
		PRINTFORMW 
RETURN 0


;-------------------------------------------------------------------------------
;住人同士イベント終了判定
;@return 1:xxx,0:xxx
;LOCAL:0	乱入したキャラの番号
;LOCAL:1	受け側のキャラ番号 or 立場が下
;LOCAL:2	攻め側のキャラ番号 or 立場が上
@INHABITANT_FRIENDSHIP_END_MASTER_MOVE
	#DIM LOOP_CHR_0
	#DIM LOOP_CHR_1
	#DIM MAX_LOOP
	#DIM 攻め側
	#DIM 受け側

	MAX_LOOP = INHABITANT_LOOP_MAX()
	FOR LOOP_CHR_0,1,MAX_LOOP
		FOR LOOP_CHR_1,0,CHARANUM
			IF CFLAG:LOOP_CHR_0:住人同士イベント内容 % 10 == 0
				受け側 = LOOP_CHR_0
				攻め側 = CFLAG:LOOP_CHR_0:住人同士イベント相手
			ELSE
				受け側 = CFLAG:LOOP_CHR_0:住人同士イベント相手
				攻め側 = LOOP_CHR_0
			ENDIF
			SIF LOOP_CHR_0 == LOOP_CHR_1
				CONTINUE
			SIF CFLAG:LOOP_CHR_0:現在位置 == CFLAG:MASTER:現在位置
				CALL INHABITANT_FRIENDSHIP_END(LOOP_CHR_0,0,MASTER,CFLAG:LOOP_CHR_0:住人同士イベントシチュエーション)
		NEXT
	NEXT

;-------------------------------------------------------------------------------
;住人同士イベント管理
;@return 1:xxx,0:xxx
@INHABITANT_FRIENDSHIP(キャラ番号,相手番号)
	#DIM キャラ番号		;処理するキャラ番号
	#DIM 相手番号		;処理するキャラの相手のキャラ番号
	#DIM 攻め側			;攻め側のキャラ番号 or 立場が上
	#DIM 受け側			;受け側のキャラ番号 or 立場が下
	IF CFLAG:キャラ番号:住人同士イベント相手 == 0 && CFLAG:キャラ番号:住人同士イベント内容 == 0
		SIF !GETBIT(FLAG:住人同士イベント設定,3) && (!GETBIT(TALENT:キャラ番号:性別,0) || !GETBIT(TALENT:相手番号:性別,0))
			RETURN 0
		IF !RAND:5
			CFLAG:キャラ番号:住人同士イベント相手 = 相手番号
			CFLAG:相手番号:住人同士イベント相手 = キャラ番号
			CALL INHABITANT_FRIENDSHIP_START(キャラ番号)
		ENDIF
	ELSEIF (CFLAG:キャラ番号:住人同士イベント相手 != 0 && CFLAG:キャラ番号:住人同士イベント内容 == 0) || (CFLAG:キャラ番号:住人同士イベント相手 == 0 && CFLAG:キャラ番号:住人同士イベント内容 != 0)
		CALL INHABITANT_FRIENDSHIP_FINISH(キャラ番号,0,0)
	ELSE
		IF CFLAG:キャラ番号:住人同士イベント内容 % 10 == 0
			受け側 = キャラ番号
			攻め側 = CFLAG:キャラ番号:住人同士イベント相手
		ELSE
			受け側 = CFLAG:キャラ番号:住人同士イベント相手
			攻め側 = キャラ番号
		ENDIF
		IF CFLAG:攻め側:住人同士イベント終了時間 > DATETIME()
			CALL INHABITANT_FRIENDSHIP_PROGRESS(攻め側,CFLAG:攻め側:住人同士イベントシチュエーション)
		ELSE
			CALL INHABITANT_FRIENDSHIP_END(攻め側,1,0,CFLAG:攻め側:住人同士イベントシチュエーション)
		ENDIF
	ENDIF
RETURN 0

;-------------------------------------------------------------------------------
;住人同士イベントスタート
;@return 1:xxx,0:xxx
;ARG	処理するキャラ番号
;LOCAL:1	受け側のキャラ番号 or 立場が下
;LOCAL:2	攻め側のキャラ番号 or 立場が上
;LOCAL:3	実行内容決定用変数
@INHABITANT_FRIENDSHIP_START(キャラ番号)
	#DIM キャラ番号		;処理するキャラ番号
	#DIM 攻め側			;攻め側のキャラ番号 or 立場が上
	#DIM 受け側			;受け側のキャラ番号 or 立場が下
	#DIM WK				;実行内容決定用変数
	
	受け側 = CFLAG:キャラ番号:住人同士イベント相手
	IF INHABITANT_FRIENDSHIP_POWER(キャラ番号) > INHABITANT_FRIENDSHIP_POWER(受け側)
		受け側 = CFLAG:キャラ番号:住人同士イベント相手
		攻め側 = キャラ番号
	ELSEIF INHABITANT_FRIENDSHIP_POWER(キャラ番号) < INHABITANT_FRIENDSHIP_POWER(受け側)
		受け側 = キャラ番号
		攻め側 = CFLAG:キャラ番号:住人同士イベント相手
	ELSE
		;暫定処理：立場が等しい場合はキャラ番号が小さい方を優先
		IF CFLAG:キャラ番号:住人同士イベント立場 >= CFLAG:受け側:住人同士イベント立場
			受け側 = CFLAG:キャラ番号:住人同士イベント相手
			攻め側 = キャラ番号
		ELSEIF CFLAG:キャラ番号:住人同士イベント立場 < CFLAG:受け側:住人同士イベント立場
			受け側 = キャラ番号
			攻め側 = CFLAG:キャラ番号:住人同士イベント相手
		ELSE
			PRINTW CFLAG 立場に不正な値が使われています
			RETURN 0
		ENDIF
	ENDIF
	WK = MIN((TA:攻め側:受け側:TA_好感度) + 1,CFLAG:攻め側:行為の上限)
	SIF WK <= 0
		WK = 1
	WK = RAND:(WK)
	IF WK < 50
		IF RAND:2 && !(TIME_PROGRESS(TCVAR:攻め側:300) < 120)
			CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_お茶,DATETIME() + RAND:5 + 10)
			SIF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%にお茶の用意をしてもらった
		ELSE
			CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_会話,DATETIME() + RAND:5 + 10)
			SIF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%に話しかけた
		ENDIF
	ELSEIF WK < 200
		CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_スキンシップ,DATETIME() + RAND:10 + 10)
		SIF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
			PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%とスキンシップを始めた
	ELSEIF WK < 300
		CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_お茶,DATETIME() + RAND:10 + 10)
		SIF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
			PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のお尻を撫で始めた
	ELSEIF WK < 500
		CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_抱きつく,DATETIME() + RAND:10 + 10)
		SIF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
			PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%に抱きついた
	ELSEIF WK < 600
		CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_キスする,DATETIME() + RAND:10 + 10)
		SIF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
			PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の唇を奪った
	ELSEIF WK < 700
		CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_胸愛撫,DATETIME() + RAND:10 + 10)
		SIF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
			PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の%OPPAI_DESCRIPTION(受け側)%を撫で始めた
	ELSEIF WK < 800
		CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_アナル愛撫,DATETIME() + RAND:10 + 10)
		SIF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
			PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のアナルに指を這わせた
	ELSEIF WK < 900
		CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_クリ愛撫,DATETIME() + RAND:10 + 10)
		IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:キャラ番号:現在位置)
			PRINTFORM %CALLNAME:攻め側%は%CALLNAME:受け側%の
			IF HAS_PENIS(受け側)
				PRINTL ペニスを握った
			ELSE
				PRINTL クリトリスを摘んだ
			ENDIF
		ENDIF
	ELSEIF WK < 1000
		CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_指挿れ,DATETIME() + RAND:10 + 10)
		IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:キャラ番号:現在位置)
			PRINTFORM %CALLNAME:攻め側%は%CALLNAME:受け側%の
			IF !HAS_VAGINA(受け側)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_クリ愛撫,-1)
				PRINTL ペニスを握った
			ELSE
				PRINTFORML %MSG_SLIT(受け側)%に指をいれた
			ENDIF
		ENDIF
	ELSE
		CALL INHABITANT_EVENT_SET(攻め側,受け側,-1,DATETIME() + RAND:10 + 20)
		WK = RAND:(ABL:受け側:Ｖ感覚 + ABL:受け側:Ａ感覚 + 1)
		IF ABL:受け側:Ｖ感覚 <= WK
			WK = 0
		ELSE
			WK = 1
		ENDIF
		;対象：ふ×ふ、ふ×♀、♂×ふ、♂×♀
		IF HAS_PENIS(攻め側) && HAS_VAGINA(受け側) && WK == 0
			IF CFLAG:攻め側:現在位置 == 場所_大浴場
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%を床に押し倒し、%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を床に押し倒し、%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF RAND:2 && BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%が服を脱ぐと同じく服を脱いで裸になった%CALLNAME:受け側%をベッドに押し倒し、%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%の服を破る勢いで脱がし、ベッドに押し倒して%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%をベッドに押し倒し、%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%をベッドに押し倒し、%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF RAND:2
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、服を脱いで裸になると%CALLNAME:受け側%を地面に押し倒して%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、服を剥ぎ取ると%CALLNAME:受け側%を地面に押し倒して%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSE
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、%CALLNAME:受け側%を地面に押し倒して%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、%CALLNAME:受け側%を地面に押し倒して%CALLNAME:受け側%の%MSG_SLIT(受け側)%にペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ENDIF
		;暫定処理：攻め側がふたなりの場合は対象外
		;対象：♀×ふ、♀×♂
		ELSEIF HAS_VAGINA(攻め側) && HAS_PENIS(受け側) && WK == 0 && !HAS_PENIS(攻め側)
			IF CFLAG:攻め側:現在位置 == 場所_大浴場
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%を床に押し倒し、自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を床に押し倒し、自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF RAND:2 && BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%が服を脱ぐと同じく服を脱いで裸になった%CALLNAME:受け側%をベッドに押し倒し、自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%が嫌がる%CALLNAME:受け側%の服を破る勢いで脱がし、ベッドに押し倒して自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%をベッドに押し倒し、自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%をベッドに押し倒し、自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF RAND:2
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、服を脱いで裸になると自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%が嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、服を剥ぎ取ると%CALLNAME:受け側%を押し倒して自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSE
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%が嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、%CALLNAME:受け側%を押し倒して自分の%MSG_SLIT(攻め側)%に%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ENDIF
		;暫定処理：両者ついていない場合は貝合わせ固定
		;対象：♀×♀
		;ELSEIF WK == 0
		ELSEIF !HAS_PENIS(攻め側) && !HAS_PENIS(受け側)
			IF CFLAG:攻め側:現在位置 == 場所_大浴場
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%を床に押し倒し、自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を床に押し倒し、自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ENDIF
				ENDIF
			ELSEIF RAND:2 && BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%が服を脱ぐと同じく服を脱いで裸になった%CALLNAME:受け側%をベッドに押し倒し、自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%の服を破る勢いで脱がし、ベッドに押し倒して自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ENDIF
				ENDIF
			ELSEIF BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) && TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%をベッドに押し倒し、自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%をベッドに押し倒し、自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ENDIF
				ENDIF
			ELSEIF RAND:2
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、服を脱いで裸になると地面に押し倒して自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、服を剥ぎ取ると%CALLNAME:受け側%を押し倒して自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ENDIF
				ENDIF
			ELSE
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、地面に押し倒して自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、地面に押し倒して自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ENDIF
				ENDIF
			ENDIF
		;暫定処理：攻め側が持っている場合は棹役固定
		;対象：ふ×♀、ふ×ふ、ふ×♂、♂×ふ、♂×♀、♂×♂
		;ELSEIF HAS_PENIS(攻め側) && WK == 1
		ELSEIF HAS_PENIS(攻め側)
			IF CFLAG:攻め側:現在位置 == 場所_大浴場
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%を床に押し倒し、%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を床に押し倒し、%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF RAND:2 && BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%が服を脱ぐと同じく服を脱いで裸になった%CALLNAME:受け側%をベッドに押し倒し、%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%の服を破る勢いで脱がし、ベッドに押し倒して%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%をベッドに押し倒し、%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%をベッドに押し倒し、%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF RAND:2
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) && TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、服を脱いで裸になると地面に押し倒して%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、服を剥ぎ取ると%CALLNAME:受け側%を押し倒して%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSE
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、地面に押し倒して%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、地面に押し倒して%CALLNAME:受け側%のアナルにペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ENDIF
		;対象：♀×ふ、♀×♂
		ELSEIF HAS_PENIS(受け側) && WK == 1
			IF CFLAG:攻め側:現在位置 == 場所_大浴場
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%を床に押し倒し、自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を床に押し倒し、自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF RAND:2 && BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%が服を脱ぐと同じく服を脱いで裸になった%CALLNAME:受け側%をベッドに押し倒し、自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%の服を破る勢いで脱がし、ベッドに押し倒して自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%をベッドに押し倒し、自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%をベッドに押し倒し、自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSEIF RAND:2
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、地面に押し倒して自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、服を剥ぎ取ると%CALLNAME:受け側%を押し倒して自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ELSE
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%と%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に移動し、地面に押し倒して自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、地面に押し倒して自分のアナルに%CALLNAME:受け側%のペニスをあてがい一気に貫いた
					ENDIF
				ENDIF
			ENDIF
		;暫定処理：両者ついていない場合は貝合わせ固定
		;対象：♀×♀
		ELSEIF !HAS_PENIS(攻め側) && !HAS_PENIS(受け側)
			IF CFLAG:攻め側:現在位置 == 場所_大浴場
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%を床に押し倒し、自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を床に押し倒し、自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ENDIF
				ENDIF
			ELSEIF BEDROOM(CFLAG:攻め側:現在位置)
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%が服を脱ぐと同じく服を脱いで裸になった%CALLNAME:受け側%をベッドに押し倒し、自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%服を破る勢いで脱がし、ベッドに押し倒して自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ENDIF
				ENDIF
			ELSE
				CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,-1)
				IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置) 
					IF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
						PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、地面に押し倒して自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ELSE
						PRINTFORML %CALLNAME:攻め側%は嫌がる%CALLNAME:受け側%を%NOT_CONSPICUOUS_PLACE(CFLAG:攻め側:現在位置)%に連れ込み、地面に押し倒して自分の%MSG_SLIT(攻め側)%を%CALLNAME:受け側%の%MSG_SLIT(受け側)%に擦りつけた
					ENDIF
				ENDIF
			ENDIF
		ELSE
			PRINTFORMW 住人イベントスタート分岐エラー 性別：{TALENT:攻め側:性別} {TALENT:受け側:性別}
		ENDIF
	ENDIF
	IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
		TRYCALLFORM INHABITANT_FRIENDSHIP_KOJO_K{攻め側}_0(CFLAG:攻め側:住人同士イベント内容%10,攻め側,受け側,0)
		TRYCALLFORM INHABITANT_FRIENDSHIP_KOJO_K{受け側}_0(CFLAG:受け側:住人同士イベント内容%10,受け側,攻め側,0)
	ENDIF
	CALL INHABITANT_FRIENDSHIP_SOURCE(攻め側,0,CFLAG:攻め側:住人同士イベントシチュエーション)
RETURN 0

;-------------------------------------------------------------------------------
;住人同士イベント過程処理
;@return 1:xxx,0:xxx
@INHABITANT_FRIENDSHIP_PROGRESS(キャラ番号,フラグ)
	#DIM キャラ番号		;処理するキャラ番号
	#DIM 攻め側			;攻め側のキャラ番号 or 立場が上
	#DIM 受け側			;受け側のキャラ番号 or 立場が下
	#DIM フラグ			;シチュエーション他
	
	IF CFLAG:キャラ番号:住人同士イベント内容 % 10 == 0
		受け側 = キャラ番号
		攻め側 = CFLAG:キャラ番号:住人同士イベント相手
	ELSE
		受け側 = CFLAG:キャラ番号:住人同士イベント相手
		攻め側 = キャラ番号
	ENDIF
	
	IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
		SELECTCASE CFLAG:攻め側:住人同士イベント内容/10
			CASE 住人同士行為_会話
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%との会話を楽しんでいる
			CASE 住人同士行為_お茶
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%とお茶を飲んでいる
			CASE 住人同士行為_スキンシップ
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%とのスキンシップを楽しんでいる
			CASE 住人同士行為_尻を撫でる
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のお尻を撫でている
			CASE 住人同士行為_抱きつく
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%を抱きしめている
			CASE 住人同士行為_キスする
				PRINTFORM %CALLNAME:攻め側%は
				IF RAND:2
					PRINTFORML 啄むように%CALLNAME:受け側%の唇を吸っている
				ELSE
					PRINTFORML %CALLNAME:受け側%の口内に舌をいれ、%CALLNAME:受け側%の舌と絡ませている
				ENDIF
			CASE 住人同士行為_胸愛撫
				PRINTFORM %CALLNAME:攻め側%は%CALLNAME:受け側%の%OPPAI_DESCRIPTION(受け側)%を
				IF TALENT:受け側:バストサイズ > 0
					PRINTL 揉んでいる
				ELSE
					PRINTL 撫でている
				ENDIF
			CASE 住人同士行為_アナル愛撫
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のアナルを指でなぞっている
			CASE 住人同士行為_クリ愛撫
				PRINTFORM %CALLNAME:攻め側%は%CALLNAME:受け側%の
				IF HAS_PENIS(受け側)
					PRINTL ペニスを優しく扱いている
				ELSE
					PRINTL クリトリスをいじっている
				ENDIF
			CASE 住人同士行為_指挿れ
				PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内の締め付けを指で堪能している
			CASE 住人同士行為_Ｖ性交Ｎ, 住人同士行為_Ｖ性交Ｃ
				PRINTFORM %CALLNAME:攻め側%は
				IF HAS_PENIS(攻め側)
					IF RAND:3
						PRINTFORML ペニスで%CALLNAME:受け側%の弱点を探っている
					ELSEIF RAND:2
						PRINTFORML ひたすら%CALLNAME:受け側%に腰を打ち付けている
					ELSE
						PRINTFORML %CALLNAME:受け側%の子宮を突き上げている
					ENDIF
				ELSEIF HAS_PENIS(受け側)
					IF RAND:2
						PRINTFORML %CALLNAME:受け側%のペニスをぐりぐり子宮に押し付けている
					ELSE
						PRINTFORML %CALLNAME:受け側%の上で腰を振っている
					ENDIF
				ELSE
					PRINTFORML %CALLNAME:受け側%に腰を押し付けている
				ENDIF
			CASE 住人同士行為_Ａ性交Ｎ,住人同士行為_Ａ性交Ｃ
				PRINTFORM %CALLNAME:攻め側%は
				IF HAS_PENIS(攻め側)
					IF RAND:2
						PRINTFORML ひたすら%CALLNAME:受け側%に腰を打ち付けている
					ELSE
						PRINTFORML ペニスをぐりぐりと%CALLNAME:受け側%の奥まで突き入れている
					ENDIF
				ELSEIF HAS_PENIS(受け側)
					PRINTFORML %CALLNAME:受け側%の上で腰を振っている
				ELSE
					PRINTFORML %CALLNAME:受け側%に腰を押し付けている
				ENDIF
			CASE 住人同士行為_Ｖ後戯Ｎ, 住人同士行為_Ｖ後戯Ｃ
				PRINTFORM %CALLNAME:攻め側%は
				IF フラグ == 1
					IF HAS_PENIS(攻め側)
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折%CALLNAME:受け側%の膣内に精液を擦りつけるように腰を揺らしている
					ELSEIF HAS_PENIS(受け側)
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折自分の膣内に精液を擦りつけるように腰を揺らしている
					ELSE
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折腰を揺らしている
					ENDIF
				ELSEIF フラグ == 2
					IF HAS_PENIS(攻め側)
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折%CALLNAME:受け側%の体にペニスを擦りつけている
					ELSEIF HAS_PENIS(受け側)
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折%CALLNAME:受け側%のペニスについたままの精液を自分の体に擦りつけている
					ELSE
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折腰を揺らしている
					ENDIF
				ELSE
					PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折腰を揺らしている
				ENDIF
			CASE 住人同士行為_Ａ後戯Ｎ, 住人同士行為_Ａ後戯Ｃ
				PRINTFORM %CALLNAME:攻め側%は
				IF フラグ == 1
					IF HAS_PENIS(攻め側)
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折%CALLNAME:受け側%のアナルに精液を擦りつけるように腰を揺らしている
					ELSEIF HAS_PENIS(受け側)
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折自分のアナルに精液を擦りつけるように腰を揺らしている
					ELSE
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折腰を揺らしている
					ENDIF
				ELSEIF フラグ == 2
					IF HAS_PENIS(攻め側)
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折%CALLNAME:受け側%の体にペニスを擦りつけている
					ELSEIF HAS_PENIS(受け側)
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折%CALLNAME:受け側%のペニスについたままの精液を自分の体に擦りつけている
					ELSE
						PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折腰を揺らしている
					ENDIF
				ELSE
					PRINTFORML %CALLNAME:受け側%の体を愛撫し、キスしながら時折腰を揺らしている
				ENDIF
		ENDSELECT
		TRYCALLFORM INHABITANT_FRIENDSHIP_KOJO_K{攻め側}_0(CFLAG:攻め側:住人同士イベント内容%10,攻め側,受け側,1)
		TRYCALLFORM INHABITANT_FRIENDSHIP_KOJO_K{受け側}_0(CFLAG:受け側:住人同士イベント内容%10,受け側,攻め側,1)
	ENDIF
RETURN 0


;-------------------------------------------------------------------------------
;住人同士イベント終了処理
;@return 1:xxx,0:xxx
@INHABITANT_FRIENDSHIP_END(キャラ番号,終わり方,乱入者,フラグ)
	#DIM キャラ番号		;処理するキャラ番号
	#DIM 終わり方		;終わり方(0=乱入による中断, 1=完了)
	#DIM 乱入者			;乱入者キャラ番号
	#DIM 攻め側			;攻め側のキャラ番号 or 立場が上
	#DIM 受け側			;受け側のキャラ番号 or 立場が下
	#DIM フラグ			;シチュエーション他
	#DIM WK
	#DIMS 乱入者名		;乱入者のキャラ名
	IF 乱入者 != 人物_訪問者
		乱入者名 = %CALLNAME:乱入者%
	ELSE
		乱入者名 = %NTR_NAME(0)%
	ENDIF
	IF CFLAG:キャラ番号:住人同士イベント内容 % 10 == 0
		受け側 = キャラ番号
		攻め側 = CFLAG:キャラ番号:住人同士イベント相手
	ELSE
		受け側 = CFLAG:キャラ番号:住人同士イベント相手
		攻め側 = キャラ番号
	ENDIF
	
	IF GETBIT(FLAG:住人同士イベント設定,2) || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:攻め側:現在位置)
		IF 終わり方 == 0
			SELECTCASE CFLAG:キャラ番号:住人同士イベント内容/10
				CASE 住人同士行為_会話
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は会話を中断したようだ
				CASE 住人同士行為_お茶
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%はお茶を飲む手を止めた
				CASE 住人同士行為_スキンシップ
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離したようだ
				CASE 住人同士行為_尻を撫でる
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から手を離したようだ
				CASE 住人同士行為_抱きつく
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離したようだ
				CASE 住人同士行為_キスする
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から離れたようだ
				CASE 住人同士行為_胸愛撫
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から手を離したようだ
					PRINTFORML %CALLNAME:受け側%は少し焦りながら服の乱れを整えている
				CASE 住人同士行為_アナル愛撫
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から手を離したようだ
					PRINTFORML %CALLNAME:受け側%は少し焦りながら服の乱れを整えている
				CASE 住人同士行為_クリ愛撫
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から手を離したようだ
					PRINTFORML %CALLNAME:受け側%は少し焦りながら服の乱れを整えている
				CASE 住人同士行為_指挿れ
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から手を離したようだ
					PRINTFORML %CALLNAME:受け側%は少し焦りながら服の乱れを整えている
				CASE 住人同士行為_Ｖ性交Ｎ
					;まだ周りを気にする余裕がある時間
					IF CFLAG:キャラ番号:住人同士イベント終了時間 - 5 > DATETIME()
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					;盛り上がってきてもうすぐ…という時間なのでぎりぎりまで気づかなかった
					ELSEIF CFLAG:キャラ番号:住人同士イベント終了時間 > DATETIME()
						PRINTFORM %乱入者名%の足音に気づき、
						IF HAS_PENIS(攻め側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離して物陰に少しでも身を隠しながら服を着ている
							PRINTFORML %CALLNAME:受け側%も太股辺りをやけに気にしながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしい
							PRINTFORML 裸で何かをしていたようだが…
						ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離して物陰に少しでも身を隠しながら服を着ている
							PRINTFORML %CALLNAME:受け側%もやけに下腹部を押さえながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしい
							PRINTFORML 裸で何かをしていたようだが…
						ELSEIF !HAS_PENIS(攻め側) && !HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離して物陰に少しでも身を隠しながら服を着ている
							PRINTFORML %CALLNAME:受け側%も太股辺りをやけに気にしながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしい
							PRINTFORML 裸で何かをしていたようだが…
						ELSE
							PRINTW 住人イベント分岐エラー(1)
						ENDIF
					;終了〜余韻まで(というのは建前で"=="だと乱入が非常に難しいから少し時間的猶予を)で入ってくるまで気づかない
					ELSEIF CFLAG:キャラ番号:住人同士イベント終了時間 + 5 >= DATETIME()
						PRINTFORM %乱入者名%が入ってきたのに気づき、
						IF HAS_PENIS(攻め側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から精液と愛液に濡れたペニスを引き抜き物陰に少しでも身を隠しながら服を着ている
							PRINTFORML %CALLNAME:受け側%も秘所から垂れる精液を気にしながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離して秘所から垂れる精液を気にしながら物陰に少しでも身を隠して服を着ている
							PRINTFORML %CALLNAME:受け側%も精液と愛液に濡れたペニスを押さえながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSEIF !HAS_PENIS(攻め側) && !HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離して物陰に少しでも身を隠しながら服を着ている
							PRINTFORML %CALLNAME:受け側%も秘所から垂れる愛液を気にしながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSE
							PRINTW 住人イベント分岐エラー(2)
						ENDIF
					;終わってから十分な時間が経過
					ELSE
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					ENDIF
				CASE 住人同士行為_Ｖ性交Ｃ
					;着衣は裸よりも余裕がある
					;まだ周りを気にする余裕がある時間
					IF CFLAG:キャラ番号:住人同士イベント終了時間 - 5 > DATETIME()
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					;盛り上がってきてもうすぐ…という時間
					ELSEIF CFLAG:キャラ番号:住人同士イベント終了時間 > DATETIME()
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					;終了〜余韻まで(というのは建前で"=="だと乱入が非常に難しいから少し時間的猶予を)で入ってくるまで気づかない
					ELSEIF CFLAG:キャラ番号:住人同士イベント終了時間 + 5 >= DATETIME()
						PRINTFORM %乱入者名%が入ってきたのに気づき、
						IF HAS_PENIS(攻め側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から精液と愛液に濡れたペニスを引き抜き下着を履き直した
							PRINTFORML %CALLNAME:受け側%も慌ててずらしていた下着を整え平静を装っている
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離してずらしていた下着を整えた
							PRINTFORML %CALLNAME:受け側%も精液と愛液に濡れたペニスを押さえながら下着を履きなおし平静を装っている
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSEIF !HAS_PENIS(攻め側) && !HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離して下着を履き直した
							PRINTFORML %CALLNAME:受け側%も秘所から垂れる愛液を気にしながら下着を履き直して平静を装っている
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSE
							PRINTW 住人イベント分岐エラー(3)
						ENDIF
					;終わってから十分な時間が経過
					ELSE
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					ENDIF
				CASE 住人同士行為_Ａ性交Ｎ
					;まだ周りを気にする余裕がある時間
					IF CFLAG:キャラ番号:住人同士イベント終了時間 - 5 > DATETIME()
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					;盛り上がってきてもうすぐ…という時間なのでぎりぎりまで気づかなかった
					ELSEIF CFLAG:キャラ番号:住人同士イベント終了時間 > DATETIME()
						PRINTFORM %乱入者名%の足音に気づき、
						IF HAS_PENIS(攻め側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離して物陰に少しでも身を隠しながら服を着ている
							PRINTFORML %CALLNAME:受け側%もお尻をやけに気にしながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしい
							PRINTFORML 裸で何かをしていたようだが…
						ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離して物陰に少しでも身を隠しながら服を着ている
							PRINTFORML %CALLNAME:受け側%もやけに下腹部を押さえながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしい
							PRINTFORML 裸で何かをしていたようだが…
						ELSE
							PRINTW 住人イベント分岐エラー(4)
						ENDIF
					;終了〜余韻まで(というのは建前で"=="だと乱入が非常に難しいから少し時間的猶予を)で入ってくるまで気づかない
					ELSEIF CFLAG:キャラ番号:住人同士イベント終了時間 + 5 >= DATETIME()
						PRINTFORM %乱入者名%が入ってきたのに気づき、
						IF HAS_PENIS(攻め側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から精液に濡れたペニスを引き抜き物陰に少しでも身を隠しながら服を着ている
							PRINTFORML %CALLNAME:受け側%もアナルから垂れる精液を気にしながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離してアナルから垂れる精液を気にしながら物陰に少しでも身を隠して服を着ている
							PRINTFORML %CALLNAME:受け側%も精液に濡れたペニスを押さえながら慌てて服を着ている
							PRINTFORML 服を着終えた二人は平静を装いながら元の位置に戻った
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSE
							PRINTW 住人イベント分岐エラー(5)
						ENDIF
					;終わってから十分な時間が経過
					ELSE
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					ENDIF
				CASE 住人同士行為_Ａ性交Ｃ
					;着衣は裸よりも余裕がある
					;まだ周りを気にする余裕がある時間
					IF CFLAG:キャラ番号:住人同士イベント終了時間 - 5 > DATETIME()
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					;盛り上がってきてもうすぐ…という時間
					ELSEIF CFLAG:キャラ番号:住人同士イベント終了時間 > DATETIME()
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					;終了〜余韻まで(というのは建前で"=="だと乱入が非常に難しいから少し時間的猶予を)で入ってくるまで気づかない
					ELSEIF CFLAG:キャラ番号:住人同士イベント終了時間 + 5 >= DATETIME()
						PRINTFORM %乱入者名%が入ってきたのに気づき、
						IF HAS_PENIS(攻め側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から精液に濡れたペニスを引き抜き下着を履き直した
							PRINTFORML %CALLNAME:受け側%も慌ててずらしていた下着を整え平静を装っている
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
							PRINTFORML %CALLNAME:攻め側%は慌てて%CALLNAME:受け側%から体を離してずらしていた下着を整えた
							PRINTFORML %CALLNAME:受け側%も精液に濡れたペニスを押さえながら下着を履きなおし平静を装っている
							PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと誤魔化せていない部分は多いが…
						ELSE
							PRINTW 住人イベント分岐エラー(6)
						ENDIF
					;終わってから十分な時間が経過
					ELSE
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
					ENDIF
				CASE 住人同士行為_Ｖ後戯Ｎ
					PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
					PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
				CASE 住人同士行為_Ｖ後戯Ｃ
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
				CASE 住人同士行為_Ａ後戯Ｎ
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
				CASE 住人同士行為_Ａ後戯Ｃ
						PRINTFORML %乱入者名%の足音に気づき、%CALLNAME:攻め側%と%CALLNAME:受け側%は少し慌てながら服の乱れを整えた
						PRINTFORML 髪の毛の乱れや汗、顔が赤かったりと何か様子がおかしいが…
			ENDSELECT
			TRYCALLFORM INHABITANT_FRIENDSHIP_KOJO_K{攻め側}_0(CFLAG:攻め側:住人同士イベント内容%10,攻め側,受け側,2)
			TRYCALLFORM INHABITANT_FRIENDSHIP_KOJO_K{受け側}_0(CFLAG:受け側:住人同士イベント内容%10,受け側,攻め側,2)
		;完了, MASTER含め乱入がないため筒抜け時か見える位置でしか表示されないはず
		ELSEIF 終わり方 == 1
			SELECTCASE CFLAG:キャラ番号:住人同士イベント内容/10
				CASE 住人同士行為_会話
					PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は会話を終えた
				CASE 住人同士行為_お茶
					PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%はお茶を飲み終えた
				CASE 住人同士行為_スキンシップ
					PRINTFORML %CALLNAME:受け側%は%CALLNAME:攻め側%とのスキンシップに満更でもないようだ
				CASE 住人同士行為_尻を撫でる
					PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のお尻の感触を満喫した
				CASE 住人同士行為_抱きつく
					PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%との抱擁を堪能した
				CASE 住人同士行為_キスする
					PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%の唇が糸を引きながら離れた
				CASE 住人同士行為_胸愛撫
					PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の胸の感触を満喫した
				CASE 住人同士行為_アナル愛撫
					PRINTFORML %CALLNAME:攻め側%はアナルを弄られて悶える%CALLNAME:受け側%の反応を満喫した
				CASE 住人同士行為_クリ愛撫
					PRINTFORML %CALLNAME:攻め側%は手を離し、指についた%CALLNAME:受け側%の愛液を舐めた
				CASE 住人同士行為_指挿れ
					PRINTFORML %CALLNAME:攻め側%は手を離し、指についた%CALLNAME:受け側%の愛液を舐めた
				CASE 住人同士行為_Ｖ性交Ｎ
					IF HAS_PENIS(攻め側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内に精液を注ぎ込み、射精を終えても硬さを失わないペニスで再び子宮を突き始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内に精液を注ぎ込み、一つになったまま動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSEIF フラグ == 2
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内に精液を注ぎ込み、精液と愛液で濡れたペニスを引き抜いて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内に精液を注ぎ込み、射精を終えると精液と愛液で濡れたペニスを引き抜いた
						ENDIF
					ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、射精を終えても硬さを失わないペニスに再び腰を動かし始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、一つになったまま動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSEIF フラグ == 2
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、秘所から精液を溢れさせながらペニスを抜いて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、秘所から精液を溢れさせながらペニスを抜いた
						ENDIF
					ELSEIF !HAS_PENIS(攻め側) && !HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%の秘所から愛液が溢れ、絶頂に達してもなお二人は腰を動かし続けた
						ELSEIF フラグ == 1 || フラグ == 2
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%の秘所から愛液が溢れ、絶頂に達してから%CALLNAME:攻め側%は動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%の秘所から愛液が溢れ、絶頂に達してから%CALLNAME:攻め側%は体を離した
						ENDIF
					ELSE
						PRINTW 住人イベント分岐エラー(7)
					ENDIF
				CASE 住人同士行為_Ｖ性交Ｃ
					IF HAS_PENIS(攻め側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内に精液を注ぎ込み、射精を終えても硬さを失わないペニスで再び子宮を突き始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内に精液を注ぎ込み、一つになったまま動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSEIF フラグ == 2
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内に精液を注ぎ込み、精液と愛液で濡れたペニスを引き抜いて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の膣内に精液を注ぎ込み、射精を終えると精液と愛液で濡れたペニスを引き抜いた
						ENDIF
					ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、射精を終えても硬さを失わないペニスに再び腰を動かし始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、一つになったまま動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSEIF フラグ == 2
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、秘所から精液を溢れさせながらペニスを抜いて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、秘所から精液を溢れさせながらペニスを抜いた
						ENDIF
					ELSEIF !HAS_PENIS(攻め側) && !HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%の秘所から愛液が溢れ、絶頂に達してもなお二人は腰を動かし続けた
						ELSEIF フラグ == 1 || フラグ == 2
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%の秘所から愛液が溢れ、絶頂に達してから%CALLNAME:攻め側%は動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%の秘所から愛液が溢れ、絶頂に達してから%CALLNAME:攻め側%は体を離した
						ENDIF
					ELSE
						PRINTW 住人イベント分岐エラー(8)
					ENDIF
				CASE 住人同士行為_Ａ性交Ｎ
					IF HAS_PENIS(攻め側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の腸内に精液を注ぎ込み、射精を終えても硬さを失わないペニスで再び突き始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の腸内に精液を注ぎ込み、一つになったまま動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSEIF フラグ == 2
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の腸内に精液を注ぎ込み、精液で濡れたペニスを引き抜いて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の腸内に精液を注ぎ込み、射精を終えると精液で濡れたペニスを引き抜いた
						ENDIF
					ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、射精を終えても硬さを失わないペニスに再び腰を動かし始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、一つになったまま動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSEIF フラグ == 2
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、アナルから精液を溢れさせながらペニスを抜いて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、アナルから精液を溢れさせながらペニスを抜いた
						ENDIF
					ELSE
						PRINTW 住人イベント分岐エラー(9)
					ENDIF
				CASE 住人同士行為_Ａ性交Ｃ
					IF HAS_PENIS(攻め側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の腸内に精液を注ぎ込み、射精を終えても硬さを失わないペニスで再び突き始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の腸内に精液を注ぎ込み、一つになったまま動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSEIF フラグ == 2
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の腸内に精液を注ぎ込み、精液で濡れたペニスを引き抜いて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の腸内に精液を注ぎ込み、射精を終えると精液で濡れたペニスを引き抜いた
						ENDIF
					ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 4 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、射精を終えても硬さを失わないペニスに再び腰を動かし始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、一つになったまま動きを止めて%CALLNAME:受け側%を抱きしめた
						ELSEIF フラグ == 2
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、アナルから精液を溢れさせながらペニスを抜いて%CALLNAME:受け側%を抱きしめた
						ELSE
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスから注がれる精液を受け止め、アナルから精液を溢れさせながらペニスを抜いた
						ENDIF
					ELSE
						PRINTW 住人イベント分岐エラー(10)
					ENDIF
				CASE 住人同士行為_Ｖ後戯Ｎ
					IF HAS_PENIS(攻め側)
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							IF RAND:2
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%に種付けするべく腰を動かし始めた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%に種付けするべくペニスを突き入れた
								ENDIF
							ELSE
								フラグ = 3
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%はペニスを引き抜き、%CALLNAME:受け側%のアナルに狙いを定め一気に突き入れた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のアナルに狙いを定め一気に突き入れた
								ENDIF
								CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,DATETIME() + RAND:10 + 20)
							ENDIF
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							IF RAND:2
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%から搾り取るべく腰を動かし始めた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%のペニスを受け入れた
								ENDIF
							ELSE
								フラグ += 2
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスを抜き、自らアナルで一気に受け入れた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスを自らアナルで一気に受け入れた
								ENDIF
								CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,DATETIME() + RAND:10 + 20)
							ENDIF
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ELSE
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%とお互いの秘所を擦りつけ始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ENDIF
				CASE 住人同士行為_Ｖ後戯Ｃ
					IF HAS_PENIS(攻め側)
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							IF RAND:2
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%に種付けするべく腰を動かし始めた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%に種付けするべくペニスを突き入れた
								ENDIF
							ELSE
								フラグ = 3
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%はペニスを引き抜き、%CALLNAME:受け側%のアナルに狙いを定め一気に突き入れた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のアナルに狙いを定め一気に突き入れた
								ENDIF
								CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｃ,DATETIME() + RAND:10 + 20)
							ENDIF
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							IF RAND:2
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%から搾り取るべく腰を動かし始めた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%のペニスを受け入れた
								ENDIF
							ELSE
								フラグ += 2
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスを抜き、自らアナルで一気に受け入れた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスを自らアナルで一気に受け入れた
								ENDIF
								CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｃ,DATETIME() + RAND:10 + 20)
							ENDIF
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ELSE
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%とお互いの秘所を擦りつけ始めた
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ENDIF
				CASE 住人同士行為_Ａ後戯Ｎ
					IF HAS_PENIS(攻め側)
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							;暫定処理：受けが男の場合はＡ固定
							IF RAND:2 || !HAS_VAGINA(受け側)
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は再び腰を動かし始めた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%のアナルにペニスを突き入れた
								ENDIF
							ELSE
								フラグ = 3
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%はペニスを引き抜き、%CALLNAME:受け側%の秘所に狙いを定め一気に突き入れた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の秘所に狙いを定め一気に突き入れた
								ENDIF
								CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,DATETIME() + RAND:10 + 20)
							ENDIF
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							;暫定処理：受けが男の場合はＡ固定
							IF RAND:2 || !HAS_VAGINA(受け側)
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%から搾り取るべく腰を動かし始めた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%のペニスを受け入れた
								ENDIF
							ELSE
								フラグ = 3
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスを抜き、秘所で一気に受け入れた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスを秘所で一気に受け入れた
								ENDIF
								CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,DATETIME() + RAND:10 + 20)
							ENDIF
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ENDIF
				CASE 住人同士行為_Ａ後戯Ｃ
					IF HAS_PENIS(攻め側)
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							;暫定処理：受けが男の場合はＡ固定
							IF RAND:2 || !HAS_VAGINA(受け側)
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は再び腰を動かし始めた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%のアナルにペニスを突き入れた
								ENDIF
							ELSE
								フラグ = 3
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%はペニスを引き抜き、%CALLNAME:受け側%の秘所に狙いを定め一気に突き入れた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の秘所に狙いを定め一気に突き入れた
								ENDIF
								CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,DATETIME() + RAND:10 + 20)
							ENDIF
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ELSEIF !HAS_PENIS(攻め側) && HAS_PENIS(受け側)
						フラグ = RAND:(BASE:攻め側:満足 * 3 * 10 / MAXBASE:攻め側:満足 / 8 + 1)
						IF フラグ == 0
							;暫定処理：受けが男の場合はＡ固定
							IF RAND:2 || !HAS_VAGINA(受け側)
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%から搾り取るべく腰を動かし始めた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は再び%CALLNAME:受け側%のペニスを受け入れた
								ENDIF
							ELSE
								フラグ = 3
								IF CFLAG:攻め側:住人同士イベントシチュエーション <= 1
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスを抜き、秘所で一気に受け入れた
								ELSE
									PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%のペニスを秘所で一気に受け入れた
								ENDIF
								CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,DATETIME() + RAND:10 + 20)
							ENDIF
						ELSEIF フラグ == 1
							PRINTFORML %CALLNAME:攻め側%は%CALLNAME:受け側%の体を愛撫し続けている
						ELSE
							PRINTFORML %CALLNAME:攻め側%と%CALLNAME:受け側%は体を離し、身なりを整えた
						ENDIF
						CFLAG:攻め側:住人同士イベントシチュエーション = フラグ
						CFLAG:受け側:住人同士イベントシチュエーション = フラグ
					ENDIF
			ENDSELECT
			TRYCALLFORM INHABITANT_FRIENDSHIP_KOJO_K{攻め側}_0(CFLAG:攻め側:住人同士イベント内容%10,攻め側,受け側,3)
			TRYCALLFORM INHABITANT_FRIENDSHIP_KOJO_K{受け側}_0(CFLAG:受け側:住人同士イベント内容%10,受け側,攻め側,3)
		ENDIF
	ENDIF
	CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,終わり方,フラグ)
RETURN 0


;-------------------------------------------------------------------------------
;住人同士イベント完了処理
;@return 1:xxx,0:xxx
;LOCAL:5	追加時間
@INHABITANT_FRIENDSHIP_FINISH(キャラ番号,終わり方,フラグ)
	#DIM キャラ番号		;処理するキャラ番号
	#DIM 終わり方		;終わり方(0=乱入による中断, 1=完了)
	#DIM 攻め側			;攻め側のキャラ番号 or 立場が上
	#DIM 受け側			;受け側のキャラ番号 or 立場が下
	#DIM フラグ			;シチュエーション他
	
	IF CFLAG:キャラ番号:住人同士イベント内容 % 10 == 0
		受け側 = キャラ番号
		攻め側 = CFLAG:キャラ番号:住人同士イベント相手
	ELSE
		受け側 = CFLAG:キャラ番号:住人同士イベント相手
		攻め側 = キャラ番号
	ENDIF
	IF 終わり方 == 0
		CFLAG:攻め側:住人同士イベント相手 = 0
		CFLAG:攻め側:住人同士イベント内容 = 0
		CFLAG:攻め側:住人同士イベント終了時間 = 0
		CFLAG:攻め側:住人同士イベントシチュエーション = 0
		CFLAG:受け側:住人同士イベント相手 = 0
		CFLAG:受け側:住人同士イベント内容 = 0
		CFLAG:受け側:住人同士イベント終了時間 = 0
		CFLAG:受け側:住人同士イベントシチュエーション = 0
	ELSE
		SELECTCASE CFLAG:キャラ番号:住人同士イベント内容/10
			CASE 住人同士行為_クリ愛撫
				STAIN:攻め側:口 |= STAIN:攻め側:手
				CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
			CASE 住人同士行為_Ｖ性交Ｎ
				IF フラグ == 0
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,DATETIME() + RAND:20 + 10)
				ELSEIF フラグ == 1 || フラグ == 2
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ後戯Ｎ,DATETIME() + RAND:5 + 10)
				ELSE
					CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
				ENDIF
			CASE 住人同士行為_Ｖ性交Ｃ
				IF フラグ == 0
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,DATETIME() + RAND:20 + 10)
				ELSEIF フラグ == 1 || フラグ == 2
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ後戯Ｃ,DATETIME() + RAND:5 + 5)
				ELSE
					CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
				ENDIF
			CASE 住人同士行為_Ａ性交Ｎ
				IF フラグ == 0
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,DATETIME() + RAND:20 + 10)
				ELSEIF フラグ == 1 || フラグ == 2
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ後戯Ｎ,DATETIME() + RAND:5 + 5)
				ELSE
					CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
				ENDIF
			CASE 住人同士行為_Ａ性交Ｃ
				IF フラグ == 0
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｃ,DATETIME() + RAND:20 + 10)
				ELSEIF フラグ == 1 || フラグ == 2
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ後戯Ｃ,DATETIME() + RAND:5 + 5)
				ELSE
					CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
				ENDIF
			CASE 住人同士行為_Ｖ後戯Ｎ
				IF フラグ == 0
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ後戯Ｎ,DATETIME() + RAND:5 + 5)
				ELSEIF フラグ == 1
					;LOCAL:5 = DATETIME() + RAND:5 + 5
				ELSEIF フラグ == 2
					CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
				ELSEIF フラグ == 3
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｎ,DATETIME() + RAND:20 + 10)
				ENDIF
			CASE 住人同士行為_Ｖ後戯Ｃ
				IF フラグ == 0
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ後戯Ｃ,DATETIME() + RAND:20 + 10)
				ELSEIF フラグ == 1
					;LOCAL:5 = DATETIME() + RAND:5 + 5
				ELSEIF フラグ == 2
					CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
				ELSEIF フラグ == 3
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ性交Ｃ,DATETIME() + RAND:20 + 10)
				ENDIF
			CASE 住人同士行為_Ａ後戯Ｎ
				IF フラグ == 0
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ後戯Ｎ,DATETIME() + RAND:20 + 10)
				ELSEIF フラグ == 1
					;LOCAL:5 = DATETIME() + RAND:5 + 5
				ELSEIF フラグ == 2
					CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
				ELSEIF フラグ == 3
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｎ,DATETIME() + RAND:20 + 10)
				ENDIF
			CASE 住人同士行為_Ａ後戯Ｃ
				IF フラグ == 0
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ａ後戯Ｃ,DATETIME() + RAND:20 + 10)
				ELSEIF フラグ == 1
					;LOCAL:5 = DATETIME() + RAND:5 + 5
				ELSEIF フラグ == 2
					CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
				ELSEIF フラグ == 3
					CALL INHABITANT_EVENT_SET(攻め側,受け側,住人同士行為_Ｖ性交Ｃ,DATETIME() + RAND:20 + 10)
				ENDIF
		CASEELSE
			CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,0,フラグ)
		ENDSELECT
		CALL INHABITANT_FRIENDSHIP_SOURCE(攻め側,終わり方,フラグ)
	ENDIF
RETURN 0


;-------------------------------------------------------------------------------
;住人同士イベントソース
;@return 1:xxx,0:xxx
@INHABITANT_FRIENDSHIP_SOURCE(キャラ番号,終わり方,フラグ)
	#DIM キャラ番号
	#DIM 終わり方		;終わり方(0=乱入による中断, 1=完了)
	#DIM フラグ			;シチュエーション他
	#DIM 攻め側			;攻め側のキャラ番号 or 立場が上
	#DIM 受け側			;受け側のキャラ番号 or 立場が下
	#DIM 攻め側増加量	;攻め側の基礎好感度増加量
	#DIM 受け側増加量	;受け側の基礎好感度増加量

	IF CFLAG:キャラ番号:住人同士イベント内容 % 10 == 0
		受け側 = キャラ番号
		攻め側 = CFLAG:キャラ番号:住人同士イベント相手
	ELSE
		受け側 = CFLAG:キャラ番号:住人同士イベント相手
		攻め側 = キャラ番号
	ENDIF
	
	;◆基礎好感度増加量リセット
		受け側増加量 = 0
		攻め側増加量 = 0
	;◆◆
	
	TCVAR:受け側:行為者 = 攻め側
	TCVAR:攻め側:行為者 = 受け側
	
	SELECTCASE CFLAG:攻め側:住人同士イベント内容/10
		CASE 住人同士行為_会話
			攻め側増加量 += 1
			DOWNBASE:攻め側:気力 += 10
			SOURCE:攻め側:歓楽 += 200
			受け側増加量 += 1
			DOWNBASE:受け側:気力 += 10
			SOURCE:受け側:歓楽 += 200
		CASE 住人同士行為_お茶
			攻め側増加量 += 3
			DOWNBASE:攻め側:気力 += 10
			SOURCE:攻め側:歓楽 += 500
			受け側増加量 += 2
			DOWNBASE:受け側:気力 += 10
			SOURCE:受け側:歓楽 += 500
			TCVAR:攻め側:飲茶日時 = DATETIME()
			TCVAR:攻め側:水分過剰摂取量 += 110000
			STAIN:攻め側:口 = 汚れ_なし
			TCVAR:受け側:飲茶日時 = DATETIME()
			TCVAR:受け側:水分過剰摂取量 += 110000
			STAIN:受け側:口 = 汚れ_なし
		CASE 住人同士行為_スキンシップ
			攻め側増加量 += 4
			DOWNBASE:攻め側:気力 += 30
			SOURCE:攻め側:歓楽 += 100
			SOURCE:攻め側:情愛 += 100
			SOURCE:攻め側:露出 += 20
			受け側増加量 += 4
			DOWNBASE:受け側:気力 += 30
			SOURCE:受け側:歓楽 += 100
			SOURCE:受け側:情愛 += 100
			SOURCE:受け側:露出 += 20
			SOURCE:受け側:反感 += 50
		CASE 住人同士行為_尻を撫でる
			攻め側増加量 += 4
			DOWNBASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 100
			SOURCE:攻め側:情愛 += 100
			受け側増加量 += ABL:攻め側:技巧 - ((200 - TA:受け側:攻め側:TA_好感度) / 10)
			DOWNBASE:受け側:気力 += 50
			SOURCE:受け側:歓楽 += 100
			SOURCE:受け側:情愛 += 100
			SOURCE:受け側:露出 += 100
			SOURCE:受け側:反感 += 200
		CASE 住人同士行為_抱きつく
			攻め側増加量 += 6
			DOWNBASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 120
			SOURCE:攻め側:情愛 += 160
			受け側増加量 += 6 - ((300 - TA:受け側:攻め側:TA_好感度) / 10)
			DOWNBASE:受け側:気力 += 50
			SOURCE:受け側:歓楽 += 120
			SOURCE:受け側:情愛 += 160
			SOURCE:受け側:露出 += 55
			SOURCE:受け側:反感 += 250
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 1
				EXP:受け側:レズ経験 += 1
			ENDIF
		CASE 住人同士行為_キスする
			攻め側増加量 += 8 + ABL:受け側:舌
			SIF EXP:攻め側:キス経験 == 0
				攻め側増加量 += 20
			DOWNBASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 180
			SOURCE:攻め側:情愛 += 200
			SOURCE:攻め側:露出 += 80
			受け側増加量 += 8 + ABL:攻め側:舌 - ((500 - TA:受け側:攻め側:TA_好感度) / 10)
			SIF EXP:受け側:キス経験 == 0
				受け側増加量 += 20
			DOWNBASE:受け側:気力 += 50
			SOURCE:受け側:歓楽 += 180
			SOURCE:受け側:情愛 += 200
			SOURCE:受け側:露出 += 80
			SOURCE:受け側:反感 += 300
			STAIN:攻め側:口 |= STAIN:受け側:口
			STAIN:受け側:口 |= STAIN:攻め側:口
			EXP:攻め側:キス経験 += 1
			EXP:受け側:キス経験 += 1
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 2
				EXP:受け側:レズ経験 += 2
			ENDIF
			CALL INHABITANT_MEMORIAL_M(攻め側,受け側,"",5)
			CALL INHABITANT_MEMORIAL_M(受け側,攻め側,"",5)
			CALL LOST_VIRGIN_M(攻め側, 受け側)
			CALL LOST_VIRGIN_M(受け側, 攻め側)
		CASE 住人同士行為_胸愛撫
			攻め側増加量 += 10
			SIF EXP:受け側:Ｂ経験 == 0
				攻め側増加量 += 20
			DOWNBASE:攻め側:体力 += 5
			DOWNBASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 100
			SOURCE:攻め側:情愛 += 150
			SOURCE:攻め側:欲情 += 200
			SOURCE:攻め側:露出 += 70
			受け側増加量 += 10 + ABL:攻め側:指 + ABL:受け側:Ｂ感覚 - ((600 - TA:受け側:攻め側:TA_好感度) / 10)
			DOWNBASE:受け側:体力 += 5
			DOWNBASE:受け側:気力 += 50
			SOURCE:受け側:快Ｂ += 120
			SOURCE:受け側:歓楽 += 100
			SOURCE:受け側:情愛 += 150
			SOURCE:受け側:欲情 += 170
			SOURCE:受け側:露出 += 70
			SOURCE:受け側:反感 += 350
			SOURCE:受け側:受動 += 120 + 240 * ABL:受け側:従順
			STAIN:受け側:Ｂ |= STAIN:攻め側:手
			STAIN:攻め側:手 |= STAIN:受け側:Ｂ
			EXP:受け側:Ｂ経験 += 1
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 3
				EXP:受け側:レズ経験 += 3
			ENDIF
		CASE 住人同士行為_アナル愛撫
			攻め側増加量 += 10
			DOWNBASE:攻め側:体力 += 40
			DOWNBASE:攻め側:気力 += 100
			SOURCE:攻め側:露出 += 120
			SOURCE:攻め側:欲情 += 200
			SOURCE:攻め側:歓楽 += 50
			SOURCE:攻め側:逸脱 += 80
			受け側増加量 += 10 - ((700 - TA:受け側:攻め側:TA_好感度) / 10)
			IF ABL:受け側:Ａ感覚 == 0
				受け側増加量 -= 20
			ELSE
				受け側増加量 += ABL:受け側:Ａ感覚
			ENDIF
			DOWNBASE:受け側:体力 += 40
			DOWNBASE:受け側:気力 += 100
			SOURCE:受け側:快Ａ += 100
			SOURCE:受け側:苦痛 += 50
			SOURCE:受け側:屈従 += 100
			SOURCE:受け側:露出 += 120
			SOURCE:受け側:欲情 += 170
			SOURCE:受け側:歓楽 += 50
			SOURCE:受け側:逸脱 += 80
			SOURCE:受け側:反感 += 60
			SOURCE:受け側:受動 += 150 + 300 * ABL:受け側:従順
			CALL 締り具合変動, 受け側, 1, 1
			STAIN:攻め側:手 |= STAIN:受け側:Ａ
			STAIN:攻め側:手 |= STAIN:受け側:腸内
			STAIN:受け側:Ａ |= STAIN:攻め側:手
			STAIN:受け側:腸内 |= STAIN:攻め側:手
			EXP:受け側:Ａ経験 += 1
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 4
				EXP:受け側:レズ経験 += 4
			ENDIF
		CASE 住人同士行為_クリ愛撫
			攻め側増加量 += 10
			DOWNBASE:攻め側:体力 += 5
			DOWNBASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 100
			SOURCE:攻め側:情愛 += 150
			SOURCE:攻め側:欲情 += 200
			SOURCE:攻め側:露出 += 100
			受け側増加量 += 10 + ABL:攻め側:指 + ABL:受け側:Ｃ感覚 - ((800 - TA:受け側:攻め側:TA_好感度) / 10)
			DOWNBASE:受け側:体力 += 5
			DOWNBASE:受け側:気力 += 50
			SOURCE:受け側:歓楽 += 100
			SOURCE:受け側:情愛 += 150
			SOURCE:受け側:欲情 += 150
			SOURCE:受け側:露出 += 100
			SOURCE:受け側:反感 += 370
			SOURCE:受け側:快Ｃ += 100
			SOURCE:受け側:受動 += 145 + 270 * ABL:受け側:従順
			STAIN:受け側:Ｖ |= STAIN:攻め側:手
			STAIN:攻め側:手 |= STAIN:受け側:Ｖ
			EXP:受け側:Ｃ経験 += 1
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 3
				EXP:受け側:レズ経験 += 3
			ENDIF
		CASE 住人同士行為_指挿れ
			TFLAG:2 = 1
			攻め側増加量 += 10
			DOWNBASE:攻め側:体力 += 30
			DOWNBASE:攻め側:気力 += 80
			IF !TALENT:受け側:処女
				SOURCE:攻め側:情愛 += 150
				SOURCE:攻め側:欲情 += 250
				SOURCE:攻め側:露出 += 120
				SOURCE:攻め側:逸脱 += 150
			ELSE
				SOURCE:攻め側:情愛 += 150
				SOURCE:攻め側:欲情 += 250
				SOURCE:攻め側:露出 += 120
				SOURCE:攻め側:逸脱 += 300
				攻め側増加量 += 20
			ENDIF
			受け側増加量 += 10 + ABL:攻め側:指 + ABL:受け側:Ｖ感覚 - ((900 - TA:受け側:攻め側:TA_好感度) / 10)
			DOWNBASE:受け側:体力 += 30
			DOWNBASE:受け側:気力 += 80
			IF !TALENT:受け側:処女
				SOURCE:受け側:快Ｖ += 120
				SOURCE:受け側:情愛 += 150
				SOURCE:受け側:苦痛 += 250
				SOURCE:受け側:欲情 += 200
				SOURCE:受け側:露出 += 120
				SOURCE:受け側:逸脱 += 150
				SOURCE:受け側:反感 += 200
			ELSE
				SOURCE:受け側:快Ｖ += 60
				SOURCE:受け側:情愛 += 150
				SOURCE:受け側:苦痛 += 250
				SOURCE:受け側:欲情 += 200
				SOURCE:受け側:露出 += 120
				SOURCE:受け側:逸脱 += 300
				SOURCE:受け側:反感 += 400
				CALL 締り具合変動, 受け側, 1, 0
			ENDIF
			STAIN:受け側:膣内 |= STAIN:攻め側:手
			STAIN:攻め側:手 |= STAIN:受け側:膣内
			EXP:受け側:Ｖ経験 += 1
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 3
				EXP:受け側:レズ経験 += 3
			ENDIF
		CASE 住人同士行為_Ｖ性交Ｎ, 住人同士行為_Ｖ性交Ｃ
			攻め側増加量 += 20
			IF HAS_PENIS(攻め側)
				TEQUIP:受け側:Ｖセックス = 攻め側
				攻め側増加量 -= (BASE:受け側:Ｖ緩さ - 700) / 100 - ABL:攻め側:Ｃ感覚
				受け側増加量 += ABL:攻め側:腰 + ABL:受け側:Ｖ感覚
				EXP:攻め側:Ｃ経験 ++
				SOURCE:攻め側:快Ｃ += 400
				EXP:受け側:Ｖ経験 ++
				EXP:受け側:Ｖ性交経験 ++
				SOURCE:受け側:快Ｖ += 400
			ELSEIF HAS_PENIS(受け側)
				TEQUIP:攻め側:Ｖセックス = 受け側
				受け側増加量 -= (BASE:受け側:Ｖ緩さ - 700) / 100 - ABL:受け側:Ｃ感覚 - ABL:攻め側:腰
				攻め側増加量 += ABL:攻め側:Ｖ感覚
				EXP:攻め側:Ｖ経験 ++
				EXP:攻め側:Ｖ性交経験 ++
				SOURCE:攻め側:快Ｖ += 400
				EXP:受け側:Ｃ経験 ++
				SOURCE:受け側:快Ｃ += 400
			ELSE
				攻め側増加量 += ABL:攻め側:Ｃ感覚
				受け側増加量 += ABL:攻め側:腰 + ABL:受け側:Ｃ感覚
				SOURCE:受け側:快Ｃ += 400
				SOURCE:攻め側:快Ｃ += 400
				EXP:受け側:Ｃ経験 ++
				EXP:攻め側:Ｃ経験 ++
			ENDIF
			DOWNBASE:攻め側:体力 += 50
			DOWNBASE:攻め側:気力 += 100
			SOURCE:攻め側:情愛 += 150
			SOURCE:攻め側:露出 += 50
			BASE:攻め側:満足 += 50
			受け側増加量 += 20 - ((1000 - TA:受け側:攻め側:TA_好感度) / 10)
			DOWNBASE:受け側:体力 += 50
			DOWNBASE:受け側:気力 += 100
			SOURCE:受け側:情愛 += 150
			SOURCE:受け側:苦痛 += 500
			SOURCE:受け側:露出 += 50
			SOURCE:受け側:反感 += 300
			BASE:受け側:満足 += 25
			IF IS_DOUTEI(攻め側) && TALENT:受け側:処女
				攻め側増加量 += 100
				受け側増加量 += 200
				SETBIT TALENT:攻め側:童貞,0
				STAIN:受け側:膣内 |= 汚れ_破瓜の血
				CALL INHABITANT_MEMORIAL_V(受け側,攻め側,"",1)
				CALL LOST_VIRGIN(受け側, 攻め側)
				TRYCALL INHABITANT_MEMORIAL_MV(攻め側,受け側,,6)
				TALENT:受け側:処女 = 0
				CFLAG:受け側:処女喪失中 = 1
			ELSEIF IS_DOUTEI(攻め側)
				攻め側増加量 += 50
				受け側増加量 += 25
				SETBIT TALENT:攻め側:童貞,0
				TRYCALL INHABITANT_MEMORIAL_MV(攻め側,受け側,,6)
			ELSEIF HAS_PENIS(攻め側) && TALENT:受け側:処女
				攻め側増加量 += 80
				受け側増加量 += 150
				STAIN:受け側:膣内 |= 汚れ_破瓜の血
				CALL INHABITANT_MEMORIAL_V(受け側,攻め側,"",1)
				CALL LOST_VIRGIN(受け側, 攻め側)
				TALENT:受け側:処女 = 0
				CFLAG:受け側:処女喪失中 = 1
			ELSEIF TALENT:攻め側:処女 && IS_DOUTEI(受け側)
				攻め側増加量 += 200
				受け側増加量 += 80
				SETBIT TALENT:受け側:童貞,0
				STAIN:攻め側:膣内 |= 汚れ_破瓜の血
				CALL INHABITANT_MEMORIAL_V(攻め側,受け側,"",1)
				CALL LOST_VIRGIN(攻め側, 受け側)
				TRYCALL INHABITANT_MEMORIAL_MV(受け側,攻め側,,6)
				TALENT:攻め側:処女 = 0
				CFLAG:攻め側:処女喪失中 = 1
			ELSEIF IS_DOUTEI(受け側)
				攻め側増加量 += 50
				受け側増加量 += 25
				SETBIT TALENT:受け側:童貞,0
				TRYCALL INHABITANT_MEMORIAL_MV(受け側,攻め側,,6)
			ELSEIF TALENT:攻め側:処女 && HAS_PENIS(受け側)
				攻め側増加量 += 150
				受け側増加量 += 50
				STAIN:攻め側:膣内 |= 汚れ_破瓜の血
				CALL INHABITANT_MEMORIAL_V(攻め側,受け側,"",1)
				CALL LOST_VIRGIN(攻め側, 受け側)
				TALENT:攻め側:処女 = 0
				CFLAG:攻め側:処女喪失中 = 1
			ENDIF
			IF HETEROSEX(受け側,攻め側)
				EXP:受け側:(50 + HETEROSEX(受け側,攻め側)) += 4
				EXP:攻め側:(50 + HETEROSEX(受け側,攻め側)) += 4
			ENDIF
			SIF 終わり方 == 1 || CFLAG:キャラ番号:住人同士イベント終了時間 <= DATETIME()
				CALL INHABITANT_FRIENDSHIP_SHOOT(攻め側)
			IF HAS_PENIS(攻め側)
				STAIN:攻め側:Ｐ |= STAIN:受け側:Ｖ
				STAIN:攻め側:Ｐ |= STAIN:受け側:膣内
				STAIN:受け側:Ｖ |= STAIN:攻め側:Ｐ
				STAIN:受け側:膣内 |= STAIN:攻め側:Ｐ
			ELSEIF HAS_PENIS(受け側)
				STAIN:受け側:Ｐ |= STAIN:攻め側:Ｖ
				STAIN:受け側:Ｐ |= STAIN:攻め側:膣内
				STAIN:攻め側:Ｖ |= STAIN:受け側:Ｐ
				STAIN:攻め側:膣内 |= STAIN:受け側:Ｐ
			ELSE
				STAIN:攻め側:Ｖ |= STAIN:受け側:Ｖ
				STAIN:攻め側:Ｖ |= STAIN:受け側:膣内
				STAIN:受け側:Ｖ |= STAIN:攻め側:Ｖ
				STAIN:受け側:Ｖ |= STAIN:攻め側:膣内
			ENDIF
		CASE 住人同士行為_Ａ性交Ｎ, 住人同士行為_Ａ性交Ｃ
			攻め側増加量 += 20  
			IF HAS_PENIS(攻め側)
				TEQUIP:受け側:Ａセックス = 攻め側
				攻め側増加量 -= (BASE:受け側:Ａ緩さ - 700) / 100 - ABL:攻め側:Ｃ感覚
				受け側増加量 += ABL:攻め側:腰
				IF ABL:受け側:Ａ感覚 <= 1
					受け側増加量 += (ABL:受け側:Ａ感覚 - 2) * 10
				ELSE
					受け側増加量 += ABL:受け側:Ａ感覚
				ENDIF
				SOURCE:攻め側:快Ｃ += 400
				EXP:攻め側:Ｃ経験 ++
				SOURCE:受け側:快Ａ += 400
				EXP:受け側:Ａ経験 ++
				EXP:受け側:Ａ性交経験 ++
			ELSEIF HAS_PENIS(受け側)
				TEQUIP:攻め側:Ａセックス = 受け側
				受け側増加量 -= (BASE:受け側:Ａ緩さ - 700) / 100 - ABL:受け側:Ｃ感覚 - ABL:攻め側:腰
				IF ABL:攻め側:Ａ感覚 <= 1
					攻め側増加量 += (ABL:攻め側:Ａ感覚 - 2) * 10
				ELSE
					攻め側増加量 += ABL:受け側:Ａ感覚
				ENDIF
				SOURCE:受け側:快Ｃ += 400
				EXP:受け側:Ｃ経験 ++
				SOURCE:攻め側:快Ａ += 400
				EXP:攻め側:Ａ経験 ++
				EXP:攻め側:Ａ性交経験 ++
			ENDIF
			DOWNBASE:攻め側:体力 += 50
			DOWNBASE:攻め側:気力 += 150
			BASE:攻め側:満足 += 50
			受け側増加量 += 20 - ((1000 - TA:受け側:攻め側:TA_好感度) / 10)
			DOWNBASE:受け側:体力 += 50
			DOWNBASE:受け側:気力 += 150
			BASE:攻め側:満足 += 25
			SOURCE:攻め側:情愛 += 50
			SOURCE:攻め側:性行動 += 500
			SOURCE:攻め側:達成 += 50
			SOURCE:攻め側:征服 += 1000
			SOURCE:攻め側:逸脱 += 500
			SOURCE:受け側:情愛 += 50
			SOURCE:受け側:性行動 += 500
			SOURCE:受け側:達成 += 50
			SOURCE:受け側:征服 += 1000
			SOURCE:受け側:逸脱 += 500
			SOURCE:受け側:反感 += 500
			IF IS_DOUTEI(攻め側)
				攻め側増加量 += 50
				受け側増加量 += 25
				SETBIT TALENT:攻め側:童貞,0
				TRYCALL INHABITANT_MEMORIAL_MV(攻め側,受け側,,7)
			ENDIF
			;同性愛　レズなら戻り値1ゲイなら戻り値2
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:(50 + HETEROSEX(受け側,攻め側)) += 4
				EXP:受け側:(50 + HETEROSEX(受け側,攻め側)) += 4
			ENDIF
			SIF 終わり方 == 1 || CFLAG:キャラ番号:住人同士イベント終了時間 <= DATETIME()
				CALL INHABITANT_FRIENDSHIP_SHOOT(攻め側)
			IF HAS_PENIS(攻め側)
				CALL INHABITANT_MEMORIAL_A(受け側,攻め側,"",1)
				CALL LOST_VIRGIN_A(受け側, 攻め側)
				STAIN:攻め側:Ｐ |= STAIN:受け側:Ａ
				STAIN:攻め側:Ｐ |= STAIN:受け側:腸内
				STAIN:受け側:Ａ |= STAIN:攻め側:Ｐ
				STAIN:受け側:腸内 |= STAIN:攻め側:Ｐ
			ELSEIF HAS_PENIS(受け側)
				CALL INHABITANT_MEMORIAL_A(攻め側,受け側,"",1)
				CALL LOST_VIRGIN_A(攻め側, 受け側)
				STAIN:受け側:Ｐ |= STAIN:攻め側:Ａ
				STAIN:受け側:Ｐ |= STAIN:攻め側:腸内
				STAIN:攻め側:Ａ |= STAIN:受け側:Ｐ
				STAIN:攻め側:腸内 |= STAIN:受け側:Ｐ
			ENDIF
		CASE 住人同士行為_Ｖ後戯Ｎ
			攻め側増加量 += 8
			BASE:攻め側:体力 += 20
			BASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 180
			SOURCE:攻め側:情愛 += 200
			SIF TA:受け側:攻め側:TA_好感度 >= CFLAG:受け側:体を許す好感度
				受け側増加量 += 8
			BASE:受け側:体力 += 20
			BASE:受け側:気力 += 50
			SOURCE:受け側:歓楽 += 180
			SOURCE:受け側:情愛 += 200
			IF CFLAG:攻め側:住人同士イベントシチュエーション == 2
				IF HAS_PENIS(攻め側)
					IF RAND:2
						STAIN:攻め側:Ｐ |= STAIN:受け側:Ｖ
						STAIN:受け側:Ｖ |= STAIN:攻め側:Ｐ
					ELSE
						STAIN:攻め側:Ｐ |= STAIN:受け側:Ａ
						STAIN:受け側:Ａ |= STAIN:攻め側:Ｐ
					ENDIF
				ELSEIF HAS_PENIS(受け側)
					IF RAND:2
						STAIN:受け側:Ｐ |= STAIN:攻め側:Ｖ
						STAIN:攻め側:Ｖ |= STAIN:受け側:Ｐ
					ELSE
						STAIN:受け側:Ｐ |= STAIN:攻め側:Ａ
						STAIN:攻め側:Ａ |= STAIN:受け側:Ｐ
					ENDIF
				ENDIF
			ENDIF
			EXP:攻め側:キス経験 += 1
			EXP:受け側:キス経験 += 1
			;愛撫による増加
			EXP:受け側:Ｃ経験 += 1
			EXP:受け側:Ｂ経験 += 1
			IF フラグ <= 1
				;挿入継続による増加
				IF HAS_PENIS(攻め側)
					EXP:攻め側:Ｃ経験 += 1
					EXP:受け側:Ｖ経験 += 1
					EXP:受け側:Ｖ性交経験 ++
				ELSEIF HAS_PENIS(受け側)
					EXP:攻め側:Ｖ経験 += 1
					EXP:攻め側:Ｖ性交経験 ++
				ELSE
					EXP:攻め側:Ｃ経験 += 1
				ENDIF
			ENDIF
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 2
				EXP:受け側:レズ経験 += 2
			ENDIF
			CALL INHABITANT_MEMORIAL_M(攻め側,受け側,"",5)
			CALL INHABITANT_MEMORIAL_M(受け側,攻め側,"",5)
			CALL LOST_VIRGIN_M(攻め側, 受け側)
			CALL LOST_VIRGIN_M(受け側, 攻め側)
		CASE 住人同士行為_Ｖ後戯Ｃ
			攻め側増加量 += 8
			BASE:攻め側:体力 += 20
			BASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 180
			SOURCE:攻め側:情愛 += 200
			受け側増加量 += 8
			BASE:受け側:体力 += 20
			BASE:受け側:気力 += 50
			SOURCE:受け側:歓楽 += 180
			SOURCE:受け側:情愛 += 200
			IF CFLAG:攻め側:住人同士イベントシチュエーション == 2
				IF HAS_PENIS(攻め側)
					IF RAND:2
						STAIN:攻め側:Ｐ |= STAIN:受け側:Ｖ
						STAIN:受け側:Ｖ |= STAIN:攻め側:Ｐ
					ELSE
						STAIN:攻め側:Ｐ |= STAIN:受け側:Ａ
						STAIN:受け側:Ａ |= STAIN:攻め側:Ｐ
					ENDIF
				ELSEIF HAS_PENIS(受け側)
					IF RAND:2
						STAIN:受け側:Ｐ |= STAIN:攻め側:Ｖ
						STAIN:攻め側:Ｖ |= STAIN:受け側:Ｐ
					ELSE
						STAIN:受け側:Ｐ |= STAIN:攻め側:Ａ
						STAIN:攻め側:Ａ |= STAIN:受け側:Ｐ
					ENDIF
				ENDIF
			ENDIF
			EXP:攻め側:キス経験 += 1
			EXP:受け側:キス経験 += 1
			;愛撫による増加
			EXP:受け側:Ｃ経験 += 1
			EXP:受け側:Ｂ経験 += 1
			IF フラグ <= 1
				;挿入継続による増加
				IF HAS_PENIS(攻め側)
					EXP:攻め側:Ｃ経験 += 1
					EXP:受け側:Ｖ経験 += 1
					EXP:受け側:Ｖ性交経験 ++
				ELSEIF HAS_PENIS(受け側)
					EXP:攻め側:Ｖ経験 += 1
					EXP:攻め側:Ｖ性交経験 ++
				ELSE
					EXP:攻め側:Ｃ経験 += 1
				ENDIF
			ENDIF
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 2
				EXP:受け側:レズ経験 += 2
			ENDIF
			CALL INHABITANT_MEMORIAL_M(攻め側,受け側,"",5)
			CALL INHABITANT_MEMORIAL_M(受け側,攻め側,"",5)
			CALL LOST_VIRGIN_M(攻め側, 受け側)
			CALL LOST_VIRGIN_M(受け側, 攻め側)
		CASE 住人同士行為_Ａ後戯Ｎ
			攻め側増加量 += 8
			BASE:攻め側:体力 += 20
			BASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 180
			SOURCE:攻め側:情愛 += 200
			受け側増加量 += 8
			BASE:受け側:体力 += 20
			BASE:受け側:気力 += 50
			SOURCE:受け側:歓楽 += 180
			SOURCE:受け側:情愛 += 200
			IF CFLAG:攻め側:住人同士イベントシチュエーション == 2
				IF HAS_PENIS(攻め側)
					IF RAND:2
						STAIN:攻め側:Ｐ |= STAIN:受け側:Ｖ
						STAIN:受け側:Ｖ |= STAIN:攻め側:Ｐ
					ELSE
						STAIN:攻め側:Ｐ |= STAIN:受け側:Ａ
						STAIN:受け側:Ａ |= STAIN:攻め側:Ｐ
					ENDIF
				ELSEIF HAS_PENIS(受け側)
					IF RAND:2
						STAIN:受け側:Ｐ |= STAIN:攻め側:Ｖ
						STAIN:攻め側:Ｖ |= STAIN:受け側:Ｐ
					ELSE
						STAIN:受け側:Ｐ |= STAIN:攻め側:Ａ
						STAIN:攻め側:Ａ |= STAIN:受け側:Ｐ
					ENDIF
				ENDIF
			ENDIF
			EXP:攻め側:キス経験 += 1
			EXP:受け側:キス経験 += 1
			;愛撫による増加
			EXP:受け側:Ｃ経験 += 1
			EXP:受け側:Ｂ経験 += 1
			IF フラグ <= 1
				;挿入継続による増加
				IF HAS_PENIS(攻め側)
					EXP:攻め側:Ｃ経験 += 1
					EXP:受け側:Ａ経験 += 1
					EXP:受け側:Ａ性交経験 ++
				ELSEIF HAS_PENIS(受け側)
					EXP:攻め側:Ａ経験 += 1
					EXP:攻め側:Ａ性交経験 ++
				ENDIF
			ENDIF
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 2
				EXP:受け側:レズ経験 += 2
			ENDIF
			CALL INHABITANT_MEMORIAL_M(攻め側,受け側,"",5)
			CALL INHABITANT_MEMORIAL_M(受け側,攻め側,"",5)
			CALL LOST_VIRGIN_M(攻め側, 受け側)
			CALL LOST_VIRGIN_M(受け側, 攻め側)
		CASE 357
			攻め側増加量 += 8
			BASE:攻め側:体力 += 20
			BASE:攻め側:気力 += 50
			SOURCE:攻め側:歓楽 += 180
			SOURCE:攻め側:情愛 += 200
			受け側増加量 += 8
			BASE:受け側:体力 += 20
			BASE:受け側:気力 += 50
			SOURCE:受け側:歓楽 += 180
			SOURCE:受け側:情愛 += 200
			IF CFLAG:攻め側:住人同士イベントシチュエーション == 2
				IF HAS_PENIS(攻め側)
					IF RAND:2
						STAIN:攻め側:Ｐ |= STAIN:受け側:Ｖ
						STAIN:受け側:Ｖ |= STAIN:攻め側:Ｐ
					ELSE
						STAIN:攻め側:Ｐ |= STAIN:受け側:Ａ
						STAIN:受け側:Ａ |= STAIN:攻め側:Ｐ
					ENDIF
				ELSEIF HAS_PENIS(受け側)
					IF RAND:2
						STAIN:受け側:Ｐ |= STAIN:攻め側:Ｖ
						STAIN:攻め側:Ｖ |= STAIN:受け側:Ｐ
					ELSE
						STAIN:受け側:Ｐ |= STAIN:攻め側:Ａ
						STAIN:攻め側:Ａ |= STAIN:受け側:Ｐ
					ENDIF
				ENDIF
			ENDIF
			EXP:攻め側:キス経験 += 1
			EXP:受け側:キス経験 += 1
			EXP:受け側:Ｃ経験 += 1
			EXP:受け側:Ｂ経験 += 1
			IF フラグ <= 1
				IF HAS_PENIS(攻め側)
					EXP:攻め側:Ｃ経験 += 1
					EXP:受け側:Ａ経験 += 1
					EXP:受け側:Ａ性交経験 ++
				ELSEIF HAS_PENIS(受け側)
					EXP:攻め側:Ａ経験 += 1
					EXP:攻め側:Ａ性交経験 ++
				ENDIF
			ENDIF
			IF HETEROSEX(受け側,攻め側)
				EXP:攻め側:レズ経験 += 2
				EXP:受け側:レズ経験 += 2
			ENDIF
			CALL INHABITANT_MEMORIAL_M(攻め側,受け側,"",5)
			CALL INHABITANT_MEMORIAL_M(受け側,攻め側,"",5)
			CALL LOST_VIRGIN_M(攻め側, 受け側)
			CALL LOST_VIRGIN_M(受け側, 攻め側)
	ENDSELECT
	
	;◆好感度の相性補正を計算
	LOCAL = 受け側増加量
	IF RELATION:受け側:攻め側
		TA:受け側:攻め側:TA_好感度 += LOCAL * RELATION:受け側:攻め側 / 100
	ELSE
		TA:受け側:攻め側:TA_好感度 += LOCAL
	ENDIF
	SIF GETBIT(FLAG:住人同士イベント設定,2) && LOCAL
		PRINTFORML 　%CALLNAME:受け側% → %CALLNAME:攻め側% Favorability \@ LOCAL >= 0 ?+{LOCAL}#{LOCAL}\@
	;血統による屈服度上昇
	IF GETBIT(FLAG:住人同士イベント設定,4) && TALENT:攻め側:訪問者の血統 && LOCAL > 0
		TIMES LOCAL, 0.73
		LOCAL = MAX(LOCAL, 1)
		CFLAG:受け側:屈服度 += LOCAL
		SIF GETBIT(FLAG:住人同士イベント設定,2)
			PRINTFORML 　%CALLNAME:受け側% Succumbing +{LOCAL}
	ENDIF
	
	LOCAL = 攻め側増加量
	IF RELATION:攻め側:受け側
		TA:攻め側:受け側:TA_好感度 += LOCAL * RELATION:攻め側:受け側 / 100
	ELSE
		TA:攻め側:受け側:TA_好感度 += LOCAL
	ENDIF
	SIF GETBIT(FLAG:住人同士イベント設定,2) && LOCAL
		PRINTFORML 　%CALLNAME:攻め側% → %CALLNAME:受け側% Favorability \@ LOCAL >= 0 ?+{LOCAL}#{LOCAL}\@
	IF GETBIT(FLAG:住人同士イベント設定,4) && TALENT:受け側:訪問者の血統 && LOCAL > 0
		TIMES LOCAL, 0.42
		LOCAL = MAX(LOCAL, 1)
		CFLAG:攻め側:屈服度 += LOCAL
		SIF GETBIT(FLAG:住人同士イベント設定,2)
			PRINTFORML 　%CALLNAME:攻め側% Succumbing +{LOCAL}
	ENDIF
	;◆◆
	
RETURN 0


;-------------------------------------------------------------------------------
;住人同士イベント射精処理
;@return 1:xxx,0:xxx
@INHABITANT_FRIENDSHIP_SHOOT(キャラ番号)
	#DIM キャラ番号	;処理するキャラ番号
	#DIM 被害者		;射精される側
	#DIM 加害者		;射精する側
	IF HAS_PENIS(キャラ番号)
		被害者 = CFLAG:キャラ番号:住人同士イベント相手
		加害者 = キャラ番号
	ELSEIF HAS_PENIS(CFLAG:キャラ番号:住人同士イベント相手)
		被害者 = キャラ番号
		加害者 = CFLAG:キャラ番号:住人同士イベント相手
	ELSE
		RETURN 0
	ENDIF
	
	;射精する側の経験処理
	EXP:加害者:射精経験 ++
	EXP:加害者:精液経験 ++
	SIF !EXP:加害者:射精経験 && HAS_VAGINA(加害者)
		EXP:加害者:異常経験 += 1
	;射精される側の経験処理
	EXP:被害者:精液経験 ++
	SETBIT STAIN:加害者:Ｐ,汚れB_精液
	SELECTCASE CFLAG:加害者:住人同士イベント内容/10
		CASE 住人同士行為_Ｖ性交Ｎ,住人同士行為_Ｖ性交Ｃ
			TEQUIP:被害者:Ｖセックス = 加害者
			TCVAR:被害者:行為者 = 加害者
			CALL EJACULATION_V(被害者, 加害者)
			;簡易絶頂判定
			IF ABL:被害者:Ｖ感覚 > RAND:5
				EXP:被害者:Ｖ絶頂経験 ++
				EXP:被害者:絶頂経験 ++
				TRYCALL 精子取得, 加害者, 被害者
			ENDIF
		CASE 住人同士行為_Ａ性交Ｎ,住人同士行為_Ａ性交Ｃ
			TEQUIP:被害者:Ａセックス = 加害者
			TCVAR:被害者:行為者 = 加害者
			CALL EJACULATION_A(被害者, 加害者)
			;簡易絶頂判定
			IF ABL:被害者:Ａ感覚 > RAND:5
				EXP:被害者:Ａ絶頂経験 ++
				EXP:被害者:絶頂経験 ++
			ENDIF
	ENDSELECT
	
	BASE:加害者:満足 += 200
	BASE:被害者:満足 += 100
	
RETURN 0


;-------------------------------------------------------------------------------
;住人同士イベント立場決定用処理
;@return 1:xxx,0:xxx
;ARG	処理するキャラ番号
@INHABITANT_FRIENDSHIP_POWER(ARG)
	#FUNCTION
	LOCAL:0 = 0
	LOCAL:0 += (ABL:ARG:サドっ気 * 2) - (ABL:ARG:マゾっ気 * 2)
	LOCAL:0 += (ABL:ARG:欲望 * 2) - (ABL:ARG:従順 * 2)
	LOCAL:0 += (ABL:ARG:技巧 * 2) + ABL:ARG:教養 + (ABL:ARG:戦闘能力 * 3 / 2)
	LOCAL:0 += ABL:ARG:指 + ABL:ARG:舌 + ABL:ARG:胸 + ABL:ARG:腰 + ABL:ARG:膣 + ABL:ARG:アナル
	LOCAL:0 += (CFLAG:ARG:住人同士イベント地位 * 4)
	LOCAL:0 += (TA:ARG:(CFLAG:ARG:住人同士イベント相手):TA_好感度 - 1000) / 100
RETURNF LOCAL:0


;-------------------------------------------------------------------------------
;青姦等の目立たない場所の文字列
;@return 1:xxx,0:xxx
@NOT_CONSPICUOUS_PLACE(ARG)
	#FUNCTIONS
	LOCALS = %""%
	SELECTCASE ARG
		CASE 場所_正門, 場所_庭, 場所_湖, 場所_人間の里, 場所_博麗神社周辺, 場所_人間の里周辺, 場所_紅魔館周辺, 場所_冥界, 場所_迷いの竹林, 場所_無縁塚, 場所_妖怪の山, 場所_地底界, 場所_魔界, 場所_魔法の森, 場所_湖南部, 場所_魔法の森内部
			LOCALS = 目立たない茂み
		CASE 場所_広間, 場所_食堂, 場所_図書室, 場所_厨房, 場所_納屋, 場所_二階踊り場, 場所_二階廊下, 場所_博麗神社, 場所_命蓮寺, 場所_白玉楼, 場所_永遠亭, 場所_守矢神社, 場所_地霊殿, 場所_霧雨魔法店, 場所_香霖堂, 場所_妖精メイド詰め所, 場所_永琳診療所
			LOCALS = 隅っこ
		CASE 場所_屋外トイレ, 場所_1Fトイレ, 場所_2Fトイレ
			LOCALS = トイレの個室
		CASEELSE
			PRINTFORML 目立たない場所例外 {ARG}
	ENDSELECT
RETURNF LOCALS


;-------------------------------------------------------------------------------
;住人同士イベント一日終了処理
;@return 1:xxx,0:xxx
@INHABITANT_FRIENDSHIP_DAYEND
	#DIM LOOP_CHR_0
	#DIM MAX_LOOP
	#DIM 攻め側			;攻め側のキャラ番号 or 立場が上
	#DIM 受け側			;受け側のキャラ番号 or 立場が下
	
	MAX_LOOP = INHABITANT_LOOP_MAX()
	FOR LOOP_CHR_0,1,MAX_LOOP
		IF CFLAG:LOOP_CHR_0:住人同士イベント相手 != 0
			IF CFLAG:LOOP_CHR_0:住人同士イベント内容 % 10 == 0
				受け側 = LOOP_CHR_0
				攻め側 = CFLAG:LOOP_CHR_0:住人同士イベント相手
			ELSE
				受け側 = CFLAG:LOOP_CHR_0:住人同士イベント相手
				攻め側 = LOOP_CHR_0
			ENDIF
			CALL INHABITANT_FRIENDSHIP_FINISH(攻め側,1,3)
		ENDIF
	NEXT
RETURN 0


;-------------------------------------------------------------------------------
;Ｖ初体験を記録する
;すでに初体験が記録されている場合は無視される
@INHABITANT_MEMORIAL_V(キャラ番号,相手番号,内容,V_TYPE)
	#DIM キャラ番号
	#DIM V_TYPE
	#DIM 相手番号
	#DIMS 内容
	
	SIF !INRANGE(キャラ番号,0,CHARANUM)
		RETURN 0
	;行為者が行為者の唇を奪うことの回避。
	IF キャラ番号 == 相手番号
		RETURN 0
	ENDIF
	
	;IF (TEQUIP:キャラ番号:Ｖセックス >= 0) && (TEQUIP:キャラ番号:Ｖセックス != TCVAR:キャラ番号:行為者)
	;	SELECTCASE TEQUIP:キャラ番号:Ｖセックス
	;		CASE IS < CHARANUM
	;			相手 = %CALLNAME:(TEQUIP:キャラ番号:Ｖセックス)%
	;		CASEELSE
	;			RETURN 0
	;	ENDSELECT
	;ELSE
	;	相手 = %""%
	;ENDIF
	IF CSTR:キャラ番号:Ｖ初体験の相手 == ""
		CSTR:キャラ番号:Ｖ初体験の相手 = %INHABITANT_MEMORIAL_CREATE(キャラ番号,相手番号,内容)%
	ENDIF
RETURN 0

;-------------------------------------------------------------------------------
;Ａ初体験を記録する
;すでに初体験が記録されている場合は無視される
@INHABITANT_MEMORIAL_A(キャラ番号,相手番号,内容,V_TYPE)
	#DIM キャラ番号
	#DIM V_TYPE
	#DIM 相手番号
	#DIMS 内容
	
	SIF !INRANGE(キャラ番号,0,CHARANUM)
		RETURN 0
	;行為者が行為者の唇を奪うことの回避。
	IF キャラ番号 == 相手番号
		RETURN 0
	ENDIF
	
	;IF (TEQUIP:キャラ番号:Ａセックス >= 0) && (TEQUIP:キャラ番号:Ａセックス != TCVAR:キャラ番号:行為者)
	;	SELECTCASE TEQUIP:キャラ番号:Ａセックス
	;		CASE IS < CHARANUM
	;			相手 = %CALLNAME:(TEQUIP:キャラ番号:Ａセックス)%
	;		CASEELSE
	;			RETURN 0
	;	ENDSELECT
	;ELSE
	;	相手 = %""%
	;ENDIF
	IF CSTR:キャラ番号:Ａ初体験の相手 == ""
		CSTR:キャラ番号:Ａ初体験の相手 = %INHABITANT_MEMORIAL_CREATE(キャラ番号,相手番号,内容)%
	ENDIF
RETURN 0

;-------------------------------------------------------------------------------
;Ｍ初体験を記録する
;すでに初体験が記録されている場合は無視される
@INHABITANT_MEMORIAL_M(キャラ番号,相手番号,内容,V_TYPE)
	#DIM キャラ番号
	#DIM V_TYPE
	#DIM 相手番号
	#DIMS 内容
	
	SIF !INRANGE(キャラ番号,0,CHARANUM)
		RETURN 0
	;行為者が行為者の唇を奪うことの回避。
	IF キャラ番号 == 相手番号
		RETURN 0
	ENDIF
	
	;IF キャラ番号 == TCVAR:キャラ番号:行為者
	;	IF 相手 == ""
	;		相手 = %CALLNAME:(CFLAG:キャラ番号:住人同士イベント相手)%
	;	ENDIF
	;ENDIF
	;IF 内容 == ""
	;	SELECTCASE TCVAR:キャラ番号:行為者
	;		CASE IS < CHARANUM
	;			IF CFLAG:キャラ番号:住人同士イベント内容%10
	;				;攻め側
	;				内容 = %"devoted it to"%
	;			ELSE
	;				LOCAL = CFLAG:キャラ番号:体を許す好感度
	;				TIMES LOCAL , 0.60
	;				IF TA:キャラ番号:(TCVAR:キャラ番号:行為者):TA_好感度 < LOCAL
	;					内容 = %"got robbed of it by"%
	;				ELSE
	;					内容 = %"gave it to"%
	;				ENDIF
	;			ENDIF
	;		CASEELSE
	;			RETURN 0
	;	ENDSELECT
	;ENDIF
	IF CSTR:キャラ番号:Ｍ初体験の相手 == ""
		CSTR:キャラ番号:Ｍ初体験の相手 = %INHABITANT_MEMORIAL_CREATE(キャラ番号,相手番号,内容)%
	ENDIF
RETURN 0

;-------------------------------------------------------------------------------
;Ｖ初体験を記録する
;すでに初体験が記録されている場合は無視される
@INHABITANT_MEMORIAL_MV(キャラ番号,相手番号,内容,V_TYPE)
	#DIM キャラ番号
	#DIM V_TYPE
	#DIM 相手番号
	#DIMS 内容
	
	SIF !INRANGE(キャラ番号,0,CHARANUM)
		RETURN 0
	;行為者が行為者の唇を奪うことの回避。
	IF キャラ番号 == 相手番号
		RETURN 0
	ENDIF
	
	;IF (TEQUIP:キャラ番号:Ｖセックス >= 0) && (TEQUIP:キャラ番号:Ｖセックス != TCVAR:キャラ番号:行為者)
	;	SELECTCASE TEQUIP:キャラ番号:Ｖセックス
	;		CASE IS < CHARANUM
	;			相手 = %CALLNAME:(TEQUIP:キャラ番号:Ｖセックス)%
	;		CASEELSE
	;			RETURN 0
	;	ENDSELECT
	;ELSE
	;	相手 = %""%
	;ENDIF
	IF CSTR:キャラ番号:ＭＶ初体験の相手 == ""
		CSTR:キャラ番号:ＭＶ初体験の相手 = %INHABITANT_MEMORIAL_CREATE(キャラ番号,相手番号,内容)%
	ENDIF
RETURN 0

;-------------------------------------------------------------------------------
;初体験の文字列を作成する
;TODO: gotta test this a lot
@INHABITANT_MEMORIAL_CREATE(キャラ番号,相手番号,内容,V_TYPE)
	#FUNCTIONS
	#DIM キャラ番号
	#DIM 相手番号
	#DIM V_TYPE
	#DIMS 日時
	#DIMS 場所
	#DIMS 内容
	#DIMS 相手 = ""
	
	;日時 = %日付_月(暦法月)+"の"+天候(天候値)+"の日に"%
	
	日時 = on the %天候(天候値)% day of %日付_月(暦法月)%, {暦法日}%CALENDAR_COUNT(暦法日)%(%GET_DAY()%)
	
	
	;場所 = %GETPLACENAME(CFLAG:キャラ番号:現在位置)+"で"%
	
	場所 = at %GETPLACENAME(CFLAG:キャラ番号:現在位置)%
	
	;行為者が行為者の初めてを奪うことの回避。
	IF キャラ番号 == 相手番号
		RETURNF 
	ENDIF
	
	IF キャラ番号 == TCVAR:キャラ番号:行為者
		IF 相手 == ""
			相手 = %CALLNAME:(CFLAG:キャラ番号:住人同士イベント相手)%
		ENDIF
	ENDIF
	IF 相手 == ""	
		SELECTCASE 相手番号
			CASE IS < CHARANUM
				相手 = %CALLNAME:相手番号%
			CASEELSE
				相手 = someone
		ENDSELECT
	ENDIF
	
	SELECTCASE V_TYPE
		CASE 1
			IF 相手番号 < CHARANUM
				相手 += "'s " + \@ HAS_PENIS(相手番号) ? %PENIS_APPEAR(相手番号)% # strapon\@
			ELSEIF 相手番号 == 998
				相手 += "'s " + Ｐ大きさ(訪問者_Ｐ大きさ) + " dick"
			ELSE
				相手 += "'s dick"
			ENDIF
		CASE 2
			相手 += "'s vibrator"
		CASE 3
			相手 += "'s anal vibrator"
		CASE 4
			相手 += "'s fingers"
		CASE 5
			相手 += "'s lips"
		CASE 6
			IF 相手番号 < CHARANUM
				相手 += "'s " + VAGINA(相手番号)
			ELSE
				相手 += "'s vagina"
			ENDIF
		CASE 7
			IF 相手番号 < CHARANUM
				相手 += "'s " + ANUS(相手番号)
			ELSE
				相手 += "'s anus"
			ENDIF
	ENDSELECT
	
	IF 内容 == ""
		SELECTCASE TCVAR:キャラ番号:行為者
			CASE IS < CHARANUM
				IF CFLAG:キャラ番号:住人同士イベント内容%10
					;攻め側
					内容 = %"devoted it to"%
				ELSE
					IF TA:キャラ番号:(TCVAR:キャラ番号:行為者):TA_好感度 < CFLAG:キャラ番号:体を許す好感度
						内容 = %"got robbed of it by"%
					ELSE
						;嫌がると表示されてからの好感度計算によりここに来る可能性あり
						内容 = %"gave it to"%
					ENDIF
				ENDIF
			CASEELSE
				内容 = %"got robbed of it by"%
		ENDSELECT
	ENDIF
;RETURNF 日時+場所+相手+内容
;Spaces included
;Format: She gave her (Virginity) to (Target) at (Place) on (Day)
RETURNF HE_SHE(キャラ番号, 1) + " " + 内容 + " " + 相手 + " " + 場所 + " " + 日時

;-------------------------------------------------------------------------------
;イベント内容、終了時間設定
@INHABITANT_EVENT_SET(攻め側,受け側,内容,終了時間)
	#DIM 攻め側
	#DIM 受け側
	#DIM 内容		; -1の時は設定しない
	#DIM 終了時間	; -1の時は設定しない

	IF -1 != 内容
		CFLAG:攻め側:住人同士イベント内容 = 内容 * 10 + 1
		CFLAG:受け側:住人同士イベント内容 = 内容 * 10 + 0
	ENDIF
	IF -1 != 終了時間
		CFLAG:攻め側:住人同士イベント終了時間 = 終了時間
		CFLAG:受け側:住人同士イベント終了時間 = 終了時間
	ENDIF
